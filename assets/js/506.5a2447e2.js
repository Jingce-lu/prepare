(window.webpackJsonp=window.webpackJsonp||[]).push([[506],{855:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"react高频面试题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react高频面试题","aria-hidden":"true"}},[t._v("#")]),t._v(" React高频面试题")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#react%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98"}},[t._v("React高频面试题")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#1react%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%9C%89%E5%93%AA%E4%BA%9B16%E7%89%88%E6%9C%AC%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%91%E7%94%9F%E4%BA%86%E5%93%AA%E4%BA%9B%E5%8F%98%E5%8C%96"}},[t._v("1.React生命周期有哪些，16版本生命周期发生了哪些变化？")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#15%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"}},[t._v("15生命周期")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#16%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"}},[t._v("16生命周期")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#2setstate%E6%98%AF%E5%90%8C%E6%AD%A5%E7%9A%84%E8%BF%98%E6%98%AF%E5%BC%82%E6%AD%A5%E7%9A%84"}},[t._v("2.setState是同步的还是异步的？")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E4%B8%AD"}},[t._v("生命周期和合成事件中")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81%E5%92%8C%E5%8E%9F%E7%94%9F%E4%BA%8B%E4%BB%B6%E4%B8%AD"}},[t._v("异步代码和原生事件中")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"}},[t._v("最佳实践")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#3%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E6%97%B6%E8%BF%9E%E7%BB%AD%E5%A4%9A%E6%AC%A1setstate%E5%8F%AA%E6%9C%89%E4%B8%80%E6%AC%A1%E7%94%9F%E6%95%88"}},[t._v("3.为什么有时连续多次setState只有一次生效？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#4react%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6"}},[t._v("4.React如何实现自己的事件机制？")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E7%BB%84%E4%BB%B6%E6%8C%82%E8%BD%BD%E6%9B%B4%E6%96%B0%E6%97%B6"}},[t._v("组件挂载、更新时：")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BA%8B%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96"}},[t._v("事件初始化：")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E8%A7%A6%E5%8F%91%E4%BA%8B%E4%BB%B6%E6%97%B6"}},[t._v("触发事件时：")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#5%E4%B8%BA%E4%BD%95react%E4%BA%8B%E4%BB%B6%E8%A6%81%E8%87%AA%E5%B7%B1%E7%BB%91%E5%AE%9Athis"}},[t._v("5.为何React事件要自己绑定this？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#6%E5%8E%9F%E7%94%9F%E4%BA%8B%E4%BB%B6%E5%92%8Creact%E4%BA%8B%E4%BB%B6%E7%9A%84%E5%8C%BA%E5%88%AB"}},[t._v("6.原生事件和React事件的区别？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#7react%E7%9A%84%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E6%98%AF%E4%BB%80%E4%B9%88"}},[t._v("7.React的合成事件是什么？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#8react%E5%92%8C%E5%8E%9F%E7%94%9F%E4%BA%8B%E4%BB%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E6%98%AF%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E6%B7%B7%E7%94%A8%E5%90%97"}},[t._v("8.React和原生事件的执行顺序是什么？可以混用吗？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#9%E8%99%9A%E6%8B%9Fdom%E6%98%AF%E4%BB%80%E4%B9%88"}},[t._v("9.虚拟Dom是什么？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#10%E8%99%9A%E6%8B%9Fdom%E6%AF%94%E6%99%AE%E9%80%9Adom%E6%9B%B4%E5%BF%AB%E5%90%97"}},[t._v("10.虚拟Dom比普通Dom更快吗？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#11%E8%99%9A%E6%8B%9Fdom%E4%B8%AD%E7%9A%84typeof%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88"}},[t._v("11.虚拟Dom中的$$typeof属性的作用是什么？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#12react%E7%BB%84%E4%BB%B6%E7%9A%84%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E6%98%AF%E4%BB%80%E4%B9%88"}},[t._v("12.React组件的渲染流程是什么？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#13%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BB%A3%E7%A0%81%E4%B8%AD%E4%B8%80%E5%AE%9A%E8%A6%81%E5%BC%95%E5%85%A5react"}},[t._v("13.为什么代码中一定要引入React？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#14%E4%B8%BA%E4%BB%80%E4%B9%88react%E7%BB%84%E4%BB%B6%E9%A6%96%E5%AD%97%E6%AF%8D%E5%BF%85%E9%A1%BB%E5%A4%A7%E5%86%99"}},[t._v("14.为什么React组件首字母必须大写？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#15react%E5%9C%A8%E6%B8%B2%E6%9F%93%E7%9C%9F%E5%AE%9Edom%E6%97%B6%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"}},[t._v("15.React在渲染真实Dom时做了哪些性能优化？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#16%E4%BB%80%E4%B9%88%E6%98%AF%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0"}},[t._v("16.什么是高阶组件？如何实现？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#17hoc%E5%9C%A8%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"}},[t._v("17.HOC在业务场景中有哪些实际应用场景？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#18%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6hoc%E5%92%8Cmixin%E7%9A%84%E5%BC%82%E5%90%8C%E7%82%B9%E6%98%AF%E4%BB%80%E4%B9%88"}},[t._v("18.高阶组件(HOC)和Mixin的异同点是什么？")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#19hook%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BC%98%E5%8A%BF"}},[t._v("19.Hook有哪些优势？")])])])])]),t._v(" "),a("h2",{attrs:{id:"_1-react生命周期有哪些，16版本生命周期发生了哪些变化？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-react生命周期有哪些，16版本生命周期发生了哪些变化？","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.React生命周期有哪些，16版本生命周期发生了哪些变化？")]),t._v(" "),a("h3",{attrs:{id:"_15生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15生命周期","aria-hidden":"true"}},[t._v("#")]),t._v(" 15生命周期")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/images/prepare/react/1909151.jpg"),alt:"images/prepare/react/1909151.jpg"}}),t._v(" "),a("ul",[a("li",[a("p",[t._v("初始化阶段")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("constructor")]),t._v(" 构造函数")]),t._v(" "),a("li",[a("code",[t._v("getDefaultProps props")]),t._v("默认值")]),t._v(" "),a("li",[a("code",[t._v("getInitialState state")]),t._v("默认值")])])]),t._v(" "),a("li",[a("p",[t._v("挂载阶段")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("componentWillMount")]),t._v(" 组件初始化渲染前调用")]),t._v(" "),a("li",[a("code",[t._v("render")]),t._v(" 组件渲染")]),t._v(" "),a("li",[a("code",[t._v("componentDidMount")]),t._v("组件挂载到 "),a("code",[t._v("DOM")]),t._v("后调用")])])]),t._v(" "),a("li",[a("p",[t._v("更新阶段")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("componentWillReceiveProps")]),t._v(" 组件将要接收新 props前调用")]),t._v(" "),a("li",[a("code",[t._v("shouldComponentUpdate")]),t._v(" 组件是否需要更新")]),t._v(" "),a("li",[a("code",[t._v("componentWillUpdate")]),t._v(" 组件更新前调用")]),t._v(" "),a("li",[a("code",[t._v("render")]),t._v(" 组件渲染")]),t._v(" "),a("li",[a("code",[t._v("componentDidUpdate")]),t._v(" 组件更新后调用")])])]),t._v(" "),a("li",[a("p",[t._v("卸载阶段")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("componentWillUnmount")]),t._v(" 组件卸载前调用")])])])]),t._v(" "),a("h3",{attrs:{id:"_16生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16生命周期","aria-hidden":"true"}},[t._v("#")]),t._v(" 16生命周期")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/images/prepare/react/1909152.jpg"),alt:"images/prepare/react/1909152.jpg"}}),t._v(" "),a("ul",[a("li",[a("p",[t._v("初始化阶段")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("constructor")]),t._v(" 构造函数")]),t._v(" "),a("li",[a("code",[t._v("getDefaultProps props")]),t._v("默认值")]),t._v(" "),a("li",[a("code",[t._v("getInitialState state")]),t._v("默认值")])])]),t._v(" "),a("li",[a("p",[t._v("挂载阶段")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("static getDerivedStateFromProps(props,state)")])]),t._v(" "),a("li",[a("code",[t._v("render")])]),t._v(" "),a("li",[a("code",[t._v("componentDidMount")])])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("getDerivedStateFromProps")]),t._v("：组件每次被 "),a("code",[t._v("rerender")]),t._v("的时候，包括在组件构建之后(虚拟 "),a("code",[t._v("dom")]),t._v("之后，实际 "),a("code",[t._v("dom")]),t._v("挂载之前)，每次获取新的 "),a("code",[t._v("props")]),t._v("或 "),a("code",[t._v("state")]),t._v("之后；每次接收新的"),a("code",[t._v("props")]),t._v("之后都会返回一个对象作为新的 "),a("code",[t._v("state")]),t._v("，返回null则说明不需要更新 "),a("code",[t._v("state")]),t._v("；配合 "),a("code",[t._v("componentDidUpdate")]),t._v("，可以覆盖 "),a("code",[t._v("componentWillReceiveProps")]),t._v("的所有用法")])])]),t._v(" "),a("li",[a("p",[t._v("更新阶段")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("static getDerivedStateFromProps(props,state)")])]),t._v(" "),a("li",[a("code",[t._v("shouldComponentUpdate")])]),t._v(" "),a("li",[a("code",[t._v("render")])]),t._v(" "),a("li",[a("code",[t._v("getSnapshotBeforeUpdate(prevProps,prevState)")])]),t._v(" "),a("li",[a("code",[t._v("componentDidUpdate")])])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("getSnapshotBeforeUpdate")]),t._v("：触发时间: "),a("code",[t._v("update")]),t._v("发生的时候，在 "),a("code",[t._v("render")]),t._v("之后，在组件 "),a("code",[t._v("dom")]),t._v("渲染之前；返回一个值，作为 "),a("code",[t._v("componentDidUpdate")]),t._v("的第三个参数；配合 "),a("code",[t._v("componentDidUpdate")]),t._v(", 可以覆盖 "),a("code",[t._v("componentWillUpdate")]),t._v("的所有用法")])])]),t._v(" "),a("li",[a("p",[t._v("卸载阶段")]),t._v(" "),a("ul",[a("li",[t._v("componentWillUnmount")])])]),t._v(" "),a("li",[a("p",[t._v("错误处理")]),t._v(" "),a("ul",[a("li",[t._v("componentDidCatch")])])])]),t._v(" "),a("p",[a("strong",[t._v("React16")]),t._v("新的生命周期弃用了 "),a("code",[t._v("componentWillMount")]),t._v("、"),a("code",[t._v("componentWillReceivePorps")]),t._v("，"),a("code",[t._v("componentWillUpdate")]),t._v("新增了 "),a("code",[t._v("getDerivedStateFromProps")]),t._v("、"),a("code",[t._v("getSnapshotBeforeUpdate")]),t._v("来代替弃用的三个钩子函数。")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("React16")]),t._v("并没有删除这三个钩子函数，但是不能和新增的钩子函数混用， "),a("strong",[t._v("React17")]),t._v("将会删除这三个钩子函数，新增了对错误的处理（ "),a("code",[t._v("componentDidCatch")]),t._v("）")])]),t._v(" "),a("h2",{attrs:{id:"_2-setstate是同步的还是异步的？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-setstate是同步的还是异步的？","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.setState是同步的还是异步的？")]),t._v(" "),a("h3",{attrs:{id:"生命周期和合成事件中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期和合成事件中","aria-hidden":"true"}},[t._v("#")]),t._v(" 生命周期和合成事件中")]),t._v(" "),a("p",[t._v("在 React的生命周期和合成事件中， React仍然处于他的更新机制中，这时无论调用多少次 setState，都不会立即执行更新，而是将要更新的"),a("code",[t._v("·")]),t._v("存入 "),a("code",[t._v("_pendingStateQueue")]),t._v("，将要更新的组件存入 "),a("code",[t._v("dirtyComponent")]),t._v("。")]),t._v(" "),a("p",[t._v("当上一次更新机制执行完毕，以生命周期为例，所有组件，即最顶层组件 "),a("code",[t._v("didmount")]),t._v("后会将批处理标志设置为 false。这时将取出 "),a("code",[t._v("dirtyComponent")]),t._v("中的组件以及 "),a("code",[t._v("_pendingStateQueue")]),t._v("中的 "),a("code",[t._v("state")]),t._v("进行更新。这样就可以确保组件不会被重新渲染多次。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentDidMount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tindex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\tconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'state'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("所以，如上面的代码，当我们在执行 setState后立即"),a("strong",[t._v("去获取 state，这时是获取不到更新后的 state的，因为处于 React的批处理机制中， state被暂存起来，待批处理机制完成之后，统一进行更新")]),t._v("。")]),t._v(" "),a("p",[t._v("所以。"),a("strong",[t._v("setState本身并不是异步的，而是 React的批处理机制给人一种异步的假象")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"异步代码和原生事件中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异步代码和原生事件中","aria-hidden":"true"}},[t._v("#")]),t._v(" 异步代码和原生事件中")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentDidMount")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'调用setState'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"state"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("如上面的代码，当我们在异步代码中调用 "),a("code",[t._v("setState")]),t._v("时，根据 "),a("code",[t._v("JavaScript")]),t._v("的异步机制，会将异步代码先暂存，等所有同步代码执行完毕后在执行，这时 "),a("code",[t._v("React")]),t._v("的批处理机制已经走完，处理标志设被设置为 "),a("code",[t._v("false")]),t._v("，这时再调用 "),a("code",[t._v("setState")]),t._v("即可立即执行更新，拿到更新后的结果。")]),t._v(" "),a("p",[a("strong",[t._v("在原生事件中调用 "),a("code",[t._v("setState")]),t._v("并不会触发 React的批处理机制，所以立即能拿到最新结果")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"最佳实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最佳实践","aria-hidden":"true"}},[t._v("#")]),t._v(" 最佳实践")]),t._v(" "),a("p",[a("code",[t._v("setState")]),t._v("的第二个参数接收一个函数，该函数会在 "),a("code",[t._v("React")]),t._v("的批处理机制完成之后调用，所以你想在调用 "),a("code",[t._v("setState")]),t._v("后立即获取更新后的值，请在该回调函数中获取。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h2",{attrs:{id:"_3-为什么有时连续多次setstate只有一次生效？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-为什么有时连续多次setstate只有一次生效？","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.为什么有时连续多次setState只有一次生效？")]),t._v(" "),a("p",[t._v("例如下面的代码，两次打印出的结果是相同的：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentDidMount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[t._v("原因就是 "),a("strong",[t._v("React会批处理机制中存储的多个 setState进行合并")]),t._v("，来看下 React源码中的 _assign函数，类似于 Object的 assign：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_assign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  nextState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" partial "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"function"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("partial")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inst"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" partial\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("如果传入的是对象，很明显会被合并成一次，所以上面的代码两次打印的结果是相同的：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  nextState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("注意， "),a("code",[t._v("assign")]),t._v("函数中对函数做了特殊处理，处理第一个参数传入的是函数，函数的参数 "),a("code",[t._v("preState")]),t._v("是前一次合并后的结果，所以计算结果是准确的：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentDidMount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" props")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" props")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br")])]),a("p",[t._v("所以上面的代码两次打印的结果是不同的。")]),t._v(" "),a("p",[a("strong",[t._v("最佳实践")])]),t._v(" "),a("p",[t._v("React会对多次连续的 setState进行合并，如果你想立即使用上次 setState后的结果进行下一次 setState，可以让 setState 接收一个函数而不是一个对象。这个函数用上一个 state 作为第一个参数，将此次更新被应用时的 props 做为第二个参数。")]),t._v(" "),a("h2",{attrs:{id:"_4-react如何实现自己的事件机制？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-react如何实现自己的事件机制？","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.React如何实现自己的事件机制？")]),t._v(" "),a("p",[t._v("React事件并没有绑定在真实的 Dom节点上，而是通过事件代理，在最外层的 document上对事件进行统一分发。")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/images/prepare/react/1909153.jpg"),alt:"images/prepare/react/1909153.jpg"}}),t._v(" "),a("h3",{attrs:{id:"组件挂载、更新时："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件挂载、更新时：","aria-hidden":"true"}},[t._v("#")]),t._v(" 组件挂载、更新时：")]),t._v(" "),a("ul",[a("li",[t._v("通过 "),a("code",[t._v("lastProps")]),t._v("、 "),a("code",[t._v("nextProps")]),t._v("判断是否新增、删除事件分别调用事件注册、卸载方法。")]),t._v(" "),a("li",[t._v("调用 "),a("code",[t._v("EventPluginHub")]),t._v("的 "),a("code",[t._v("enqueuePutListener")]),t._v("进行事件存储")]),t._v(" "),a("li",[t._v("获取 "),a("code",[t._v("document")]),t._v("对象。")]),t._v(" "),a("li",[t._v("根据事件名称（如 "),a("code",[t._v("onClick")]),t._v("、 "),a("code",[t._v("onCaptureClick")]),t._v("）判断是进行冒泡还是捕获。")]),t._v(" "),a("li",[t._v("判断是否存在 "),a("code",[t._v("addEventListener")]),t._v("方法，否则使用 "),a("code",[t._v("attachEvent")]),t._v("（兼容IE）。")]),t._v(" "),a("li",[t._v("给 "),a("code",[t._v("document")]),t._v("注册原生事件回调为 "),a("code",[t._v("dispatchEvent")]),t._v("(统一的事件分发机制）。")])]),t._v(" "),a("h3",{attrs:{id:"事件初始化："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件初始化：","aria-hidden":"true"}},[t._v("#")]),t._v(" 事件初始化：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("EventPluginHub")]),t._v("负责管理 "),a("code",[t._v("React")]),t._v("合成事件的 "),a("code",[t._v("callback")]),t._v("，它将 "),a("code",[t._v("callback")]),t._v("存储在 "),a("code",[t._v("listenerBank")]),t._v("中，另外还存储了负责合成事件的 "),a("code",[t._v("Plugin")]),t._v("。")]),t._v(" "),a("li",[t._v("获取绑定事件的元素的唯一标识 "),a("code",[t._v("key")]),t._v("。")]),t._v(" "),a("li",[t._v("将 "),a("code",[t._v("callback")]),t._v("根据事件类型，元素的唯一标识 "),a("code",[t._v("key")]),t._v("存储在 "),a("code",[t._v("listenerBank")]),t._v("中。")]),t._v(" "),a("li",[a("code",[t._v("listenerBank")]),t._v("的结构是： "),a("code",[t._v("listenerBank[registrationName][key]")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"触发事件时："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#触发事件时：","aria-hidden":"true"}},[t._v("#")]),t._v(" 触发事件时：")]),t._v(" "),a("ul",[a("li",[t._v("触发 "),a("code",[t._v("document")]),t._v("注册原生事件的回调 "),a("code",[t._v("dispatchEvent")])]),t._v(" "),a("li",[t._v("获取到触发这个事件最深一级的元素")]),t._v(" "),a("li",[t._v("遍历这个元素的所有父元素，依次对每一级元素进行处理。")]),t._v(" "),a("li",[t._v("构造合成事件。")]),t._v(" "),a("li",[t._v("将每一级的合成事件存储在 "),a("code",[t._v("eventQueue")]),t._v("事件队列中。")]),t._v(" "),a("li",[t._v("遍历 "),a("code",[t._v("eventQueue")]),t._v("。")]),t._v(" "),a("li",[t._v("通过 "),a("code",[t._v("isPropagationStopped")]),t._v("判断当前事件是否执行了阻止冒泡方法。")]),t._v(" "),a("li",[t._v("如果阻止了冒泡，停止遍历，否则通过 executeDispatch执行合成事件。")]),t._v(" "),a("li",[t._v("释放处理完成的事件。")])]),t._v(" "),a("blockquote",[a("p",[t._v("React在自己的合成事件中重写了 "),a("code",[t._v("stopPropagation")]),t._v("方法，将 "),a("code",[t._v("isPropagationStopped")]),t._v("设置为 "),a("code",[t._v("true")]),t._v("，然后在遍历每一级事件的过程中根据此遍历判断是否继续执行。"),a("code",[t._v("这就是 React自己实现的冒泡机制")]),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"_5-为何react事件要自己绑定this？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-为何react事件要自己绑定this？","aria-hidden":"true"}},[t._v("#")]),t._v(" 5.为何React事件要自己绑定this？")]),t._v(" "),a("p",[t._v("在上面提到的事件处理流程中， React在 document上进行统一的事件分发， "),a("code",[t._v("dispatchEvent")]),t._v("通过循环调用所有层级的事件来模拟事件冒泡和捕获。")]),t._v(" "),a("p",[t._v("在 React源码中，当具体到某一事件处理函数将要调用时，将调用 "),a("code",[t._v("invokeGuardedCallback")]),t._v("方法。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeGuardedCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("caughtError "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      caughtError "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("可见，"),a("strong",[t._v("事件处理函数是直接调用的，并没有指定调用的组件，所以不进行手动绑定的情况下直接获取到的 this是不准确的，所以我们需要手动将当前组件绑定到 this上")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"_6-原生事件和react事件的区别？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-原生事件和react事件的区别？","aria-hidden":"true"}},[t._v("#")]),t._v(" 6.原生事件和React事件的区别？")]),t._v(" "),a("ul",[a("li",[t._v("React 事件使用驼峰命名，而不是全部小写。")]),t._v(" "),a("li",[t._v("通过 JSX , 你传递一个函数作为事件处理程序，而不是一个字符串。")]),t._v(" "),a("li",[t._v("在 React 中你不能通过返回 "),a("code",[t._v("false")]),t._v(" 来阻止默认行为。必须明确调用 "),a("code",[t._v("preventDefault")]),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"_7-react的合成事件是什么？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-react的合成事件是什么？","aria-hidden":"true"}},[t._v("#")]),t._v(" 7.React的合成事件是什么？")]),t._v(" "),a("p",[t._v("React 根据 W3C 规范定义了每个事件处理函数的参数，即合成事件。")]),t._v(" "),a("p",[t._v("事件处理程序将传递 "),a("code",[t._v("SyntheticEvent")]),t._v(" 的实例，这是一个跨浏览器原生事件包装器。它具有与浏览器原生事件相同的接口，包括 "),a("code",[t._v("stopPropagation()")]),t._v(" 和 "),a("code",[t._v("preventDefault()")]),t._v("，在所有浏览器中他们工作方式都相同。")]),t._v(" "),a("p",[t._v("React合成的 "),a("code",[t._v("SyntheticEvent")]),t._v("采用了事件池，这样做可以大大节省内存，而不会频繁的创建和销毁事件对象。")]),t._v(" "),a("p",[t._v("另外，不管在什么浏览器环境下，浏览器会将该事件类型统一创建为合成事件，从而达到了浏览器兼容的目的。")]),t._v(" "),a("h2",{attrs:{id:"_8-react和原生事件的执行顺序是什么？可以混用吗？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-react和原生事件的执行顺序是什么？可以混用吗？","aria-hidden":"true"}},[t._v("#")]),t._v(" 8.React和原生事件的执行顺序是什么？可以混用吗？")]),t._v(" "),a("p",[a("code",[t._v("React")]),t._v("的所有事件都通过 "),a("code",[t._v("document")]),t._v("进行统一分发。当真实 Dom触发事件后冒泡到 "),a("code",[t._v("document")]),t._v("后才会对 "),a("code",[t._v("React")]),t._v("事件进行处理。")]),t._v(" "),a("p",[t._v("所以原生的事件会先执行，然后执行 "),a("code",[t._v("React")]),t._v("合成事件，最后执行真正在 "),a("code",[t._v("document")]),t._v("上挂载的事件")]),t._v(" "),a("p",[a("code",[t._v("React")]),t._v("事件和原生事件最好不要混用。原生事件中如果执行了 "),a("code",[t._v("stopPropagation")]),t._v("方法，则会导致其他 "),a("code",[t._v("React")]),t._v("事件失效。因为所有元素的事件将无法冒泡到 "),a("code",[t._v("document")]),t._v("上，导致所有的 "),a("code",[t._v("React")]),t._v("事件都将无法被触发。。")]),t._v(" "),a("h2",{attrs:{id:"_9-虚拟dom是什么？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-虚拟dom是什么？","aria-hidden":"true"}},[t._v("#")]),t._v(" 9.虚拟Dom是什么？")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/images/prepare/react/1909154.jpg"),alt:"images/prepare/react/1909154.jpg"}}),t._v(" "),a("p",[t._v("在原生的 JavaScript程序中，我们直接对 DOM进行创建和更改，而 DOM元素通过我们监听的事件和我们的应用程序进行通讯。")]),t._v(" "),a("p",[t._v("而 React会先将你的代码转换成一个 JavaScript对象，然后这个 JavaScript对象再转换成真实 DOM。这个 JavaScript对象就是所谓的虚拟 DOM。")]),t._v(" "),a("p",[t._v("当我们需要创建或更新元素时， React首先会让这个 "),a("code",[t._v("VitrualDom")]),t._v("对象进行创建和更改，然后再将 "),a("code",[t._v("VitrualDom")]),t._v("对象渲染成真实DOM。")]),t._v(" "),a("p",[t._v("当我们需要对 DOM进行事件监听时，首先对 "),a("code",[t._v("VitrualDom")]),t._v("进行事件监听， "),a("code",[t._v("VitrualDom")]),t._v("会代理原生的 DOM事件从而做出响应。")]),t._v(" "),a("h2",{attrs:{id:"_10-虚拟dom比普通dom更快吗？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-虚拟dom比普通dom更快吗？","aria-hidden":"true"}},[t._v("#")]),t._v(" 10.虚拟Dom比普通Dom更快吗？")]),t._v(" "),a("p",[t._v("很多文章说 "),a("code",[t._v("VitrualDom")]),t._v("可以提升性能，这一说法实际上是很片面的。")]),t._v(" "),a("p",[t._v("直接操作 DOM是非常耗费性能的，这一点毋庸置疑。但是 React使用 "),a("code",[t._v("VitrualDom")]),t._v("也是无法避免操作 DOM的。")]),t._v(" "),a("p",[t._v("如果是首次渲染， "),a("code",[t._v("VitrualDom")]),t._v("不具有任何优势，甚至它要进行更多的计算，消耗更多的内存。")]),t._v(" "),a("p",[a("code",[t._v("VitrualDom")]),t._v("的优势在于 React的 "),a("code",[t._v("Diff")]),t._v("算法和批处理策略， React在页面更新之前，提前计算好了如何进行更新和渲染 "),a("code",[t._v("DOM")]),t._v("。实际上，这个计算过程我们在直接操作 "),a("code",[t._v("DOM")]),t._v('时，也是可以自己判断和实现的，但是一定会耗费非常多的精力和时间，而且往往我们自己做的是不如 React好的。所以，在这个过程中 React帮助我们"提升了性能"。')]),t._v(" "),a("p",[t._v("所以，我更倾向于说， "),a("code",[t._v("VitrualDom")]),t._v("帮助我们提高了开发效率，在重复渲染时它帮助我们计算如何更高效的更新，而不是它比 "),a("code",[t._v("DOM")]),t._v("操作更快。")]),t._v(" "),a("h2",{attrs:{id:"_11-虚拟dom中的-typeof属性的作用是什么？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-虚拟dom中的-typeof属性的作用是什么？","aria-hidden":"true"}},[t._v("#")]),t._v(" 11.虚拟Dom中的$$typeof属性的作用是什么？")]),t._v(" "),a("p",[a("code",[t._v("ReactElement")]),t._v("中有一个 "),a("code",[t._v("$$typeof")]),t._v("属性，它被赋值为 "),a("code",[t._v("REACT_ELEMENT_TYPE")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REACT_ELEMENT_TYPE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" Symbol "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"function"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" Symbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("for "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" Symbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"react.element"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xeac7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("可见， "),a("code",[t._v("$$typeof")]),t._v("是一个 "),a("code",[t._v("Symbol")]),t._v("类型的变量，这个变量可以防止 "),a("code",[t._v("XSS")]),t._v("。")]),t._v(" "),a("p",[t._v("如果你的服务器有一个漏洞，允许用户存储任意 "),a("code",[t._v("JSON")]),t._v("对象， 而客户端代码需要一个字符串，这可能会成为一个问题：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// json")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" expectedTextButGotJSON "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    dangerouslySetInnerHTML"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      __html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/* put your exploit here */"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" expectedTextButGotJSON\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[a("code",[t._v("JSON")]),t._v("中不能存储 "),a("code",[t._v("Symbol")]),t._v("类型的变量。")]),t._v(" "),a("p",[a("code",[t._v("ReactElement.isValidElement")]),t._v("函数用来判断一个 React组件是否是有效的，下面是它的具体实现。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("ReactElement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("isValidElement")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" object "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"object"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n    object "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n    object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$$"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REACT_ELEMENT_TYPE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("可见 "),a("code",[t._v("React")]),t._v("渲染时会把没有 "),a("code",[t._v("$$typeof")]),t._v("标识，以及规则校验不通过的组件过滤掉。")]),t._v(" "),a("p",[t._v("当你的环境不支持 "),a("code",[t._v("Symbol")]),t._v("时， "),a("code",[t._v("$$typeof")]),t._v("被赋值为 "),a("code",[t._v("0xeac7")]),t._v("，至于为什么， React开发者给出了答案：")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("0xeac7")]),t._v("看起来有点像 "),a("code",[t._v("React")]),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"_12-react组件的渲染流程是什么？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-react组件的渲染流程是什么？","aria-hidden":"true"}},[t._v("#")]),t._v(" 12.React组件的渲染流程是什么？")]),t._v(" "),a("ul",[a("li",[t._v("使用 "),a("code",[t._v("React.createElement")]),t._v("或 "),a("code",[t._v("JSX")]),t._v("编写 React组件，实际上所有的 JSX代码最后都会转换成 "),a("code",[t._v("React.createElement(...)")]),t._v("， Babel帮助我们完成了这个转换的过程。")]),t._v(" "),a("li",[a("code",[t._v("createElement")]),t._v("函数对 "),a("code",[t._v("key")]),t._v("和 "),a("code",[t._v("ref")]),t._v("等特殊的 "),a("code",[t._v("props")]),t._v("进行处理，并获取 "),a("code",[t._v("defaultProps")]),t._v("对默认 "),a("code",[t._v("props")]),t._v("进行赋值，并且对传入的孩子节点进行处理，最终构造成一个 "),a("code",[t._v("ReactElement")]),t._v("对象（所谓的虚拟 DOM）。")]),t._v(" "),a("li",[a("code",[t._v("ReactDOM.render")]),t._v("将生成好的虚拟 "),a("code",[t._v("DOM")]),t._v("渲染到指定容器上，其中采用了批处理、事务等机制并且对特定浏览器进行了性能优化，最终转换为真实 "),a("code",[t._v("DOM")]),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"_13-为什么代码中一定要引入react？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-为什么代码中一定要引入react？","aria-hidden":"true"}},[t._v("#")]),t._v(" 13.为什么代码中一定要引入React？")]),t._v(" "),a("p",[a("code",[t._v("JSX")]),t._v("只是为 "),a("code",[t._v("React.createElement(component,props,...children)")]),t._v("方法提供的语法糖。")]),t._v(" "),a("p",[t._v("所有的 "),a("code",[t._v("JSX")]),t._v("代码最后都会转换成 "),a("code",[t._v("React.createElement(...)")]),t._v("， "),a("code",[t._v("Babel")]),t._v("帮助我们完成了这个转换的过程。")]),t._v(" "),a("p",[t._v("所以使用了 "),a("code",[t._v("JSX")]),t._v("的代码都必须引入 "),a("code",[t._v("React")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"_14-为什么react组件首字母必须大写？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-为什么react组件首字母必须大写？","aria-hidden":"true"}},[t._v("#")]),t._v(" 14.为什么React组件首字母必须大写？")]),t._v(" "),a("p",[t._v("babel在编译时会判断 JSX中组件的首字母，当首字母为小写时，其被认定为原生 DOM标签， "),a("code",[t._v("createElement")]),t._v("的第一个变量被编译为字符串；当首字母为大写时，其被认定为自定义组件， "),a("code",[t._v("createElement")]),t._v("的第一个变量被编译为对象；")]),t._v(" "),a("h2",{attrs:{id:"_15-react在渲染真实dom时做了哪些性能优化？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-react在渲染真实dom时做了哪些性能优化？","aria-hidden":"true"}},[t._v("#")]),t._v(" 15.React在渲染真实Dom时做了哪些性能优化？")]),t._v(" "),a("p",[t._v("在 IE（8-11）和 Edge浏览器中，一个一个插入无子孙的节点，效率要远高于插入一整个序列化完整的节点树。")]),t._v(" "),a("p",[a("code",[t._v("React")]),t._v("通过 "),a("code",[t._v("lazyTree")]),t._v("，在 IE（8-11）和 Edge中进行单个节点依次渲染节点，而在其他浏览器中则首先将整个大的 DOM结构构建好，然后再整体插入容器。")]),t._v(" "),a("p",[t._v("并且，在单独渲染节点时， React还考虑了 "),a("code",[t._v("fragment")]),t._v("等特殊节点，这些节点则不会一个一个插入渲染。")]),t._v(" "),a("h2",{attrs:{id:"_16-什么是高阶组件？如何实现？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-什么是高阶组件？如何实现？","aria-hidden":"true"}},[t._v("#")]),t._v(" 16.什么是高阶组件？如何实现？")]),t._v(" "),a("p",[a("strong",[t._v("高阶组件可以看作 React对装饰模式的一种实现，高阶组件就是一个函数，且该函数接受一个组件作为参数，并返回一个新的组件")]),t._v("。")]),t._v(" "),a("blockquote",[a("p",[t._v("高阶组件（ "),a("code",[t._v("HOC")]),t._v(" ）是 "),a("code",[t._v("React")]),t._v("中的高级技术，用来重用组件逻辑。但高阶组件本身并不是 "),a("code",[t._v("ReactAPI")]),t._v("。它只是一种模式，这种模式是由 "),a("code",[t._v("React")]),t._v("自身的组合性质必然产生的。")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("visible")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("WrappedComponent")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("extends")]),t._v("  Component "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" visible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("props "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("visible "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" alse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("WrappedComponent "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("上面的代码就是一个 "),a("code",[t._v("HOC")]),t._v("的简单应用，函数接收一个组件作为参数，并返回一个新组件，新组建可以接收一个 "),a("code",[t._v("visible props")]),t._v("，根据 "),a("code",[t._v("visible")]),t._v("的值来判断是否渲染Visible。")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/images/prepare/react/1909155.jpg"),alt:"images/prepare/react/1909155.jpg"}}),t._v(" "),a("p",[t._v("我们可以通过以下两种方式实现高阶组件：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("属性代理"),a("br"),t._v("\n函数返回一个我们自己定义的组件，然后在 "),a("code",[t._v("render")]),t._v("中返回要包裹的组件，这样我们就可以代理所有传入的 "),a("code",[t._v("props")]),t._v("，并且决定如何渲染，实际上 ，这种方式生成的高阶组件就是原组件的父组件，上面的函数 "),a("code",[t._v("visible")]),t._v("就是一个 HOC属性代理的实现方式。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("proxyHOC")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("WrappedComponent")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("extends")]),t._v("  Component "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("WrappedComponent "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("对比原生组件增强的项：")]),t._v(" "),a("ul",[a("li",[t._v("可操作所有传入的 "),a("code",[t._v("props")])]),t._v(" "),a("li",[t._v("可操作组件的生命周期")]),t._v(" "),a("li",[t._v("可操作组件的 "),a("code",[t._v("static")]),t._v("方法")]),t._v(" "),a("li",[t._v("获取 "),a("code",[t._v("refs")])])])]),t._v(" "),a("li",[a("p",[t._v("反向继承\n返回一个组件，继承原组件，在 render中调用原组件的 render。由于继承了原组件，能通过this访问到原组件的 生命周期、props、state、render等，相比属性代理它能操作更多的属性。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("inheritHOC")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("WrappedComponent")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("extends")]),t._v("  Component "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("对比原生组件增强的项：")]),t._v(" "),a("ul",[a("li",[t._v("可操作所有传入的 "),a("code",[t._v("props")])]),t._v(" "),a("li",[t._v("可操作组件的生命周期")]),t._v(" "),a("li",[t._v("可操作组件的 "),a("code",[t._v("static")]),t._v("方法")]),t._v(" "),a("li",[t._v("获取 "),a("code",[t._v("refs")])]),t._v(" "),a("li",[t._v("可操作 "),a("code",[t._v("state")])]),t._v(" "),a("li",[t._v("可以渲染劫持")])])])]),t._v(" "),a("h2",{attrs:{id:"_17-hoc在业务场景中有哪些实际应用场景？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_17-hoc在业务场景中有哪些实际应用场景？","aria-hidden":"true"}},[t._v("#")]),t._v(" 17.HOC在业务场景中有哪些实际应用场景？")]),t._v(" "),a("p",[t._v("HOC可以实现的功能：")]),t._v(" "),a("ul",[a("li",[t._v("组合渲染")]),t._v(" "),a("li",[t._v("条件渲染")]),t._v(" "),a("li",[t._v("操作 props")]),t._v(" "),a("li",[t._v("获取 refs")]),t._v(" "),a("li",[t._v("状态管理")]),t._v(" "),a("li",[t._v("操作 state")]),t._v(" "),a("li",[t._v("渲染劫持")])]),t._v(" "),a("p",[t._v("HOC在业务中的实际应用场景：")]),t._v(" "),a("ul",[a("li",[t._v("日志打点")]),t._v(" "),a("li",[t._v("权限控制")]),t._v(" "),a("li",[t._v("双向绑定")]),t._v(" "),a("li",[t._v("表单校验")])]),t._v(" "),a("h2",{attrs:{id:"_18-高阶组件-hoc-和mixin的异同点是什么？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_18-高阶组件-hoc-和mixin的异同点是什么？","aria-hidden":"true"}},[t._v("#")]),t._v(" 18.高阶组件(HOC)和Mixin的异同点是什么？")]),t._v(" "),a("p",[a("code",[t._v("Mixin")]),t._v("和 "),a("code",[t._v("HOC")]),t._v("都可以用来解决 React的代码复用问题。")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/images/prepare/react/1909156.jpg"),alt:"images/prepare/react/1909156.jpg"}}),t._v(" "),a("ul",[a("li",[t._v("Mixin 可能会相互依赖，相互耦合，不利于代码维护")]),t._v(" "),a("li",[t._v("不同的 Mixin中的方法可能会相互冲突")]),t._v(" "),a("li",[t._v("Mixin非常多时，组件是可以感知到的，甚至还要为其做相关处理，这样会给代码造成滚雪球式的复杂性")])]),t._v(" "),a("p",[t._v("而 HOC的出现可以解决这些问题：")]),t._v(" "),a("ul",[a("li",[t._v("高阶组件就是一个没有副作用的纯函数，各个高阶组件不会互相依赖耦合")]),t._v(" "),a("li",[t._v("高阶组件也有可能造成冲突，但我们可以在遵守约定的情况下避免这些行为")]),t._v(" "),a("li",[t._v("高阶组件并不关心数据使用的方式和原因，而被包裹的组件也不关心数据来自何处。高阶组件的增加不会为原组件增加负担")])]),t._v(" "),a("h2",{attrs:{id:"_19-hook有哪些优势？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_19-hook有哪些优势？","aria-hidden":"true"}},[t._v("#")]),t._v(" 19.Hook有哪些优势？")]),t._v(" "),a("ol",[a("li",[t._v("减少状态逻辑复用的风险\nHook和 Mixin在用法上有一定的相似之处，但是 Mixin引入的逻辑和状态是可以相互覆盖的，而多个 Hook之间互不影响，这让我们不需要在把一部分精力放在防止避免逻辑复用的冲突上。在不遵守约定的情况下使用 HOC也有可能带来一定冲突，比如 props覆盖等等，使用 Hook则可以避免这些问题。")]),t._v(" "),a("li",[t._v("避免地狱式嵌套\n大量使用 HOC的情况下让我们的代码变得嵌套层级非常深，使用 HOC，我们可以实现扁平式的状态逻辑复用，而避免了大量的组件嵌套。")]),t._v(" "),a("li",[t._v("让组件更容易理解\n在使用 class组件构建我们的程序时，他们各自拥有自己的状态，业务逻辑的复杂使这些组件变得越来越庞大，各个生命周期中会调用越来越多的逻辑，越来越难以维护。使用 Hook，可以让你更大限度的将公用逻辑抽离，将一个组件分割成更小的函数，而不是强制基于生命周期方法进行分割。")]),t._v(" "),a("li",[t._v("使用函数代替class\n相比函数，编写一个 class可能需要掌握更多的知识，需要注意的点也越多，比如 this指向、绑定事件等等。另外，计算机理解一个 class比理解一个函数更快。Hooks让你可以在 classes之外使用更多 React的新特性。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);