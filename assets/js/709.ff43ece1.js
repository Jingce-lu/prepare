(window.webpackJsonp=window.webpackJsonp||[]).push([[709],{835:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"跨域解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域解决方案","aria-hidden":"true"}},[t._v("#")]),t._v(" 跨域解决方案")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"}},[t._v("跨域解决方案")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E4%B8%80%E5%89%8D%E8%A8%80"}},[t._v("一、前言")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BA%8C%E8%B7%A8%E5%9F%9F%E8%B5%B7%E6%BA%90"}},[t._v("二、跨域起源")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E4%B8%89%E8%B7%A8%E5%9F%9F%E7%A4%BA%E4%BE%8B"}},[t._v("三、跨域示例")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%9B%9B%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"}},[t._v("四、跨域解决方案")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#1-documentdomain"}},[t._v("1. document.domain")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#2-windowlocationhash"}},[t._v("2. window.location.hash")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#3-windowname"}},[t._v("3. window.name")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#4-websocket"}},[t._v("4. WebSocket")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#5-windowpostmessage"}},[t._v("5. window.postMessage")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#6-jsonp"}},[t._v("6. JSONP")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#7-cors"}},[t._v("7. CORS")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#8-ngnix"}},[t._v("8. Ngnix")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%9B%BE%E7%89%87ping-%E8%B7%A8%E5%9F%9F"}},[t._v("图片Ping 跨域")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%90%86"}},[t._v("服务器代理")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%AF%B9%E6%AF%94"}},[t._v("对比")])])])])]),t._v(" "),a("h2",{attrs:{id:"一、前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、前言","aria-hidden":"true"}},[t._v("#")]),t._v(" 一、前言")]),t._v(" "),a("p",[t._v("跨域问题在前端已经是老生常谈了，本文围绕着为什么产生跨域以及几种解决方案详细说明。")]),t._v(" "),a("h2",{attrs:{id:"二、跨域起源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、跨域起源","aria-hidden":"true"}},[t._v("#")]),t._v(" 二、跨域起源")]),t._v(" "),a("p",[t._v("说到跨域不得不提到浏览器的同源策略（1995年，Netscape公司提出的，现在适用于所有浏览器），所谓同源策略，即协议相同、域名相同、端口相同。如果三者之一有所不同就认为是跨域。")]),t._v(" "),a("h2",{attrs:{id:"三、跨域示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、跨域示例","aria-hidden":"true"}},[t._v("#")]),t._v(" 三、跨域示例")]),t._v(" "),a("p",[t._v("域名：    https://www.hao123.com/index.html（默认80端口）")]),t._v(" "),a("p",[t._v("同源：    https://www.hao123.com/find.html（协议、域名、端口均相同）")]),t._v(" "),a("p",[t._v("不同源：")]),t._v(" "),a("ul",[a("li",[t._v("http://www.hao123.com/index.html（https 和 http，协议不同）")]),t._v(" "),a("li",[t._v("https://www.hao123456.com/index.html（hao123 和 hao123456.com，域名不同）")]),t._v(" "),a("li",[t._v("https://www.hao123.com:8090/index.html（80 和 8090，端口不同）")])]),t._v(" "),a("h2",{attrs:{id:"四、跨域解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、跨域解决方案","aria-hidden":"true"}},[t._v("#")]),t._v(" 四、跨域解决方案")]),t._v(" "),a("h3",{attrs:{id:"_1-document-domain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-document-domain","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. document.domain")]),t._v(" "),a("p",[t._v("目标：父域A页面（https://www.hao123.com ）向子域B页面（https://www.second.hao123.com）请求数据；")]),t._v(" "),a("p",[t._v("步骤：")]),t._v(" "),a("ol",[a("li",[t._v("在A页面与B页面的脚本中分别设置document.domain。\n"),a("blockquote",[a("p",[t._v("document.domain='hao123'")])])]),t._v(" "),a("li",[t._v("在B页面中添加 Cookie。\n"),a("blockquote",[a("p",[t._v('document.cookie = "val=hello";')])])]),t._v(" "),a("li",[t._v("在A页面中获取 Cookie。\n"),a("blockquote",[a("p",[t._v("var cookieFromSon = document.cookie;"),a("br"),t._v("\nconsole.log(cookieFromSon); //val=hello")])])])]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：设置简单，通信方便。")]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：仅适用于子域与父域不同，协议、顶级域、端口均相同。")]),t._v(" "),a("h3",{attrs:{id:"_2-window-location-hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-window-location-hash","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. window.location.hash")]),t._v(" "),a("p",[t._v("目标：A页面（https://www.hao123.com）向不同域 B页面（https://www.hao123456.com）请求数据。")]),t._v(" "),a("p",[t._v("步骤：")]),t._v(" "),a("ol",[a("li",[t._v("在A页面添加指向B页面的 iframe 标签，并将参数添加到 # 后面 。"),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("www.hao123456.com#123"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("b_iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("iframe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("li",[t._v("在B页面添加指向C页面（www.hao123.com/c.html，代理页面，与A页面同域）的 iframe 标签。"),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("www.hao123.com/c.html#456"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("c_iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("iframe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("li",[t._v("在C页面（www.hao123.com/c.html）获取同域A页面的 hash 值并改变。"),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hash "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("substring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//parent即不同域B页面,parent.parent即同域A页面")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//步骤分解：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1.代理页面C页面获取不同域B页面的hash值（self.location.hash.substring(1)）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2.赋值给同域A页面（parent.parent.location.hash）")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])]),t._v(" "),a("li",[t._v("在A页面获取数据。"),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onhashchange")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//456")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])])]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：不限制域。")]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：需要通过代理页；双方都需要创建 iframe 标签；数据直接暴露在url中，数据容量和类型有限。")]),t._v(" "),a("h3",{attrs:{id:"_3-window-name"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-window-name","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. window.name")]),t._v(" "),a("p",[t._v("目标：A页面（https://www.hao123.com）向不同域 B页面（https://www.hao123456.com）请求数据。")]),t._v(" "),a("p",[t._v("步骤：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("在A页面添加指向B页面的 iframe 标签。")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("www.hao123456.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("iframe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("在 B页面的脚本中添加 window.name，以及跳转到与父页面同域的代理页；")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//name长度在2MB")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://www.hao123.com/proxy.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("我是子页面，点我跳到与父页面相同域的代理页"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("同域的代理页有值之后即可在 A页面取值；")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" val "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iframe'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//'123'；")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])])]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：不限制域，window.name 容量很大，在2MB；")]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：只能通过 iframe 标签跨域；需要借助代理页；需要实时监听 window.name 变化，影响性能。")]),t._v(" "),a("h3",{attrs:{id:"_4-websocket"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-websocket","aria-hidden":"true"}},[t._v("#")]),t._v(" 4. WebSocket")]),t._v(" "),a("p",[t._v("WebSocket是一种通信协议，使用ws://和wss://作为协议前缀，该协议不受同源策略限制，只要服务器支持，都可以通信。")]),t._v(" "),a("p",[t._v("WebSocket请求头信息：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("chat "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),t._v("\nHost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("example"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\nUpgrade"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" websocket\nConnection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Upgrade\nSec"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("WebSocket"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" x3JJHMbDL1EzLkh9GBhXDw"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\nSec"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("WebSocket"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Protocol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" chat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" superchat\nSec"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("WebSocket"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("\nOrigin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/www.hao123.com/")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[a("strong",[t._v("优点")]),t._v("：因为有了Origin字段，所以不受同源策略限制，只要域名在白名单内，服务器就允许通信。")]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：协议限制，仅适用于WebSocket协议。")]),t._v(" "),a("h3",{attrs:{id:"_5-window-postmessage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-window-postmessage","aria-hidden":"true"}},[t._v("#")]),t._v(" 5. window.postMessage")]),t._v(" "),a("p",[t._v("postMessage是HTML5的新特性，可以实现跨域通信。")]),t._v(" "),a("p",[t._v("window.postMessage(message，targetOrigin) 方法是HTML5新特性，可以用来向其他所有的 window 对象发送消息。")]),t._v(" "),a("p",[t._v("需要注意的是我们必须要保证所有的脚本执行完才发送 MessageEvent，如果在函数执行的过程中调用了它，就会让后面的函数超时无法执行。")]),t._v(" "),a("p",[t._v("目标：A页面（https://www.hao123.com）向不同域 B页面（https://www.hao123456.com）请求数据。")]),t._v(" "),a("p",[t._v("步骤：")]),t._v(" "),a("ol",[a("li",[t._v("在B页面发送postMessage。"),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("opener"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://www.hao123.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//第一个参数为发送数据的内容，第二个参数为接收方地址，格式为协议+域名+端口,80端口可省略。")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[t._v("在A页面接收数据"),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//event 中有三个属性，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//e.data 传输过来的内容，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//e.source 发放方的窗口，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//e.origin 发送方的地址；")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//source和origin结合可以反向发送数据，e.source.postMessage('我收到消息了',e.origin)。")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])])]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：不限制域，实现简单。")]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：发放方在不同环境下需要动态配置接收方的不同域名。")]),t._v(" "),a("h3",{attrs:{id:"_6-jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-jsonp","aria-hidden":"true"}},[t._v("#")]),t._v(" 6. JSONP")]),t._v(" "),a("p",[t._v("JSONP的思想是在页面动态插入一个script标签，向服务器请求JSON数据，服务器收到请求后，将数据放在一个指定名字的回调函数中返回。")]),t._v(" "),a("p",[t._v("目标：客户端（https://www.hao123.com）向不同域 服务端（https://www.hao123456.com）请求数据。")]),t._v(" "),a("p",[t._v("步骤：")]),t._v(" "),a("ol",[a("li",[t._v("在客户端发起ajax请求。"),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//jQuery，会动态的创建script标签，提供一个回调函数作为参数拼接在服务端的地址上，并在拿到数据后销毁")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//创建的标签如<script src="www.hao123456.com/user?callback=getData&id=1001"><\/script>')]),t._v("\n$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ajax")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      \n        url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'www.hao123456.com/user'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        dataType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsonp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        jsonp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"getData"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        contentType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json;charset=utf-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//处理data数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])])]),t._v(" "),a("li",[t._v("服务端接收到请求，返回调用的回调函数。"),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//服务端调用回调函数")]),t._v("\nString jsonpCallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getParameter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"getData"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nMap"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" resp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"val"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" jsonpCallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"("')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" JSONObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toJSONString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('")"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])])]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：不限制域，设置方便，支持老的浏览器。")]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("只允许 GET 类型的请求；")]),t._v(" "),a("li",[t._v("前后端需要协同回调函数名；")]),t._v(" "),a("li",[t._v("发送的不是XHR请求，不能使用该请求的特性（如异步，事件）。")]),t._v(" "),a("li",[t._v("由于是从其它域中加载代码执行，因此如果其他域不安全，很可能会在响应中夹带一些恶意代码。")]),t._v(" "),a("li",[t._v("要确定 JSONP 请求是否失败并不容易。虽然 HTML5 给 script 标签新增了一个 onerror 事件处理程序，但是存在兼容性问题。")])]),t._v(" "),a("h3",{attrs:{id:"_7-cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-cors","aria-hidden":"true"}},[t._v("#")]),t._v(" 7. CORS")]),t._v(" "),a("p",[t._v("CORS（Cross-Origin Resource Sharing）是跨域资源共享，是W3C的标准，使用自定义的HTTP头部允许浏览器和服务器相互了解，从而决定是否通信。")]),t._v(" "),a("p",[t._v("目标：客户端（https://www.hao123.com）向不同域 服务端（https://www.hao123456.com）请求数据。")]),t._v(" "),a("p",[t._v("步骤：")]),t._v(" "),a("ol",[a("li",[t._v("在客户端发起 ajax 请求。"),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ajax")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      \n        url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'www.hao123456.com/user'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("     \n        contentType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json;charset=utf-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//处理data数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])])]),t._v(" "),a("li",[t._v("服务端设置HTTP请求头如下"),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.hao123.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//请求域地址，可设置*")]),t._v("\nresponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Methods"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//请求方式")]),t._v("\nresponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Credentials"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//是否允许发送Cookie，如果不允许，去掉这一行即可")]),t._v("\nresponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Headers"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//请求头设置")]),t._v("\nresponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Max-Age"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3600"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//过期时间1分钟")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])])]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：设置简单，支持多种请求方式。")]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("存在兼容性问题，特别是 IE10 以下的浏览器。 IE6、IE7、Opera min 不支持CORS。")]),t._v(" "),a("li",[t._v("第一次发送非简单请求时会多一次请求。")])]),t._v(" "),a("h3",{attrs:{id:"_8-ngnix"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-ngnix","aria-hidden":"true"}},[t._v("#")]),t._v(" 8. Ngnix")]),t._v(" "),a("p",[t._v("目标：客户端（https://www.hao123.com）向不同域 服务端（https://www.hao123456.com）请求数据。")]),t._v(" "),a("p",[t._v("步骤：")]),t._v(" "),a("ol",[a("li",[t._v("ngnix配置如下"),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#当前服务的域名")]),t._v("\n  location /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass https://www.hao123.com/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#把所有的请求都转到www.hao123.com这个域名")]),t._v("\n    add_header Access-Control-Allow-Methods *"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add_header Access-Contro-Max-Age "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3600")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add_header Access-Control-Allow-Credentials true；\n    add_header Access-Control-Allow-Origin "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_origin")]),t._v("；\n    add_header Access-Control-Allow-Headers "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_access_control_allow_headers")]),t._v("；\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#预检命令直接返回204")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_method")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("204")]),t._v("；\n       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])])]),t._v(" "),a("li",[t._v("配置好之后重启 nginx -s reload")])]),t._v(" "),a("p",[a("strong",[t._v("优点")]),t._v("：不限制域，设置简单。")]),t._v(" "),a("p",[a("strong",[t._v("缺点")]),t._v("：依赖于ngnix的配置。")]),t._v(" "),a("h3",{attrs:{id:"图片ping-跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片ping-跨域","aria-hidden":"true"}},[t._v("#")]),t._v(" 图片Ping 跨域")]),t._v(" "),a("p",[t._v("优点: 用于实现跟踪用户点击页面或动态广告曝光次数有较大的优势。")]),t._v(" "),a("p",[t._v("缺点:")]),t._v(" "),a("ul",[a("li",[t._v("只支持 GET 请求。")]),t._v(" "),a("li",[t._v("无法访问服务器的响应文本（单向请求）")])]),t._v(" "),a("h3",{attrs:{id:"服务器代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器代理","aria-hidden":"true"}},[t._v("#")]),t._v(" 服务器代理")]),t._v(" "),a("p",[a("strong",[t._v("万能")])]),t._v(" "),a("p",[t._v("浏览器有跨域限制，但是服务器不存在跨域问题，所以可以由服务器请求所要域的资源再返回给客户端。")]),t._v(" "),a("p",[t._v("DomainA客户端（浏览器） ==> DomainA服务器 ==> DomainB服务器 ==> DomainA客户端（浏览器）")]),t._v(" "),a("p",[t._v("注：在以上的解决方案中，用的最多的就是 "),a("code",[t._v("window.postMessage")]),t._v("、"),a("code",[t._v("JSONP")]),t._v("、"),a("code",[t._v("CORS")]),t._v(" 和 "),a("code",[t._v("Ngnix")]),t._v(" 这四种。")]),t._v(" "),a("h2",{attrs:{id:"对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对比","aria-hidden":"true"}},[t._v("#")]),t._v(" 对比")]),t._v(" "),a("table",{attrs:{border:"1"}},[a("caption",[t._v("跨域解决方案一览表")]),t._v(" "),a("tr",[a("th",[t._v("序号")]),t._v(" "),a("th",[t._v("解决方案")]),t._v(" "),a("th",[t._v("简述")]),t._v(" "),a("th",[t._v("优点")]),t._v(" "),a("th",[t._v("优点")])]),t._v(" "),a("tr",[a("td",[t._v("1")]),t._v(" "),a("td",[t._v("document.domain")]),t._v(" "),a("td",[t._v("将子域和父域的domain都设置成父域地址")]),t._v(" "),a("td",[t._v("设置简单")]),t._v(" "),a("td",[t._v("仅限于子域名与父域名不同的情况")])]),t._v(" "),a("tr",[a("td",[t._v("2")]),t._v(" "),a("td",[t._v("window.location.hash")]),t._v(" "),a("td",[t._v("A与B通信，通过代理页C（与A同域）来设置")]),t._v(" "),a("td",[t._v("用于与iframe标签嵌入的页面进行通信")]),t._v(" "),a("td",[t._v("1、设置起来比较麻烦，需要借助代理页。"),a("br"),t._v("\n        2、数据容量和类型有限制")])]),t._v(" "),a("tr",[a("td",[t._v("3")]),t._v(" "),a("td",[t._v("window.name")]),t._v(" "),a("td",[t._v("A与B通信，也需要通过代理页C（与A同域）完成")]),t._v(" "),a("td",[t._v("\n      1、适用于与iframe标签嵌入的页面进行通信 "),a("br"),t._v("\n      2、与location.hash对比容量较大，可以容纳2MB\n    ")]),t._v(" "),a("td",[t._v("设置起来比较麻烦，需要借助代理页。")])]),t._v(" "),a("tr",[a("td",[t._v("4")]),t._v(" "),a("td",[t._v("Websocket")]),t._v(" "),a("td",[t._v("Websocket是一种通信协议，不受同源策略限制。 只要设置了Origin字段，并且域名在白名单范围内，服务器就可以通信")]),t._v(" "),a("td",[t._v("只要设置了Origin字段，并且域名在白名单范围内，服务器就可以通信")]),t._v(" "),a("td",[t._v("只适用于ws://和wss://作为协议前缀的域名")])]),t._v(" "),a("tr",[a("td",[t._v("5")]),t._v(" "),a("td",[t._v("postMessage")]),t._v(" "),a("td",[t._v("\n      发送方可通过postMessage（msg,origin）发送消息，写明发送内容和发送方域名地址（协议+域名+端口）即可。"),a("br"),t._v("\n      接收方可通过onmessage进行监听拿到消息。\n    ")]),t._v(" "),a("td",[t._v("设置简单，可用于向服务器请求数据，也可以进行网页之间的传值。")]),t._v(" "),a("td",[t._v("\n      1、发送方和接收方均要注意判断源地址，以免信息泄露。"),a("br"),t._v("\n      2、在实际开发中要注意配置不同的环境地址。（开发、测试和生产）\n    ")])]),t._v(" "),a("tr",[a("td",[t._v("6")]),t._v(" "),a("td",[t._v("jsonp ")]),t._v(" "),a("td",[t._v("\n      通过插入script标签，发送请求，因为非xhr请求，所以不受浏览器限制，即可实现跨越。\n    ")]),t._v(" "),a("td",[t._v("设置简单，可兼容老的浏览器")]),t._v(" "),a("td",[t._v("\n      1、需要前后端配合，协同回调函数名。"),a("br"),t._v("\n      2、因为不是xhr请求，所以不具备该请求的特性。\n    ")])]),t._v(" "),a("tr",[a("td",[t._v("7")]),t._v(" "),a("td",[t._v("CORS  ")]),t._v(" "),a("td",[t._v("\n      CORS即跨域资源共享，是w3c的标准，使用自定义的http请求头，服务端设置Access-Control-Allow-Origin为请求方域名或者* \n    ")]),t._v(" "),a("td",[t._v("设置简单，最常用的跨域办法。")]),t._v(" "),a("td",[t._v("\n      不兼容老的浏览器（IE6、IE7、Opera min）\n    ")])]),t._v(" "),a("tr",[a("td",[t._v("8")]),t._v(" "),a("td",[t._v("Ngnix  ")]),t._v(" "),a("td",[t._v("\n      通过ngnix配置，将数据发送方的地址转发到数据请求方，就避免了跨域问题。\n    ")]),t._v(" "),a("td",[t._v("设置简单")]),t._v(" "),a("td",[t._v("\n      依赖于ngnix配置\n    ")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);