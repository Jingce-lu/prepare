(window.webpackJsonp=window.webpackJsonp||[]).push([[594],{937:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_7-个角度吃透-lodash-防抖节流原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-个角度吃透-lodash-防抖节流原理","aria-hidden":"true"}},[s._v("#")]),s._v(" 7 个角度吃透 Lodash 防抖节流原理")]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#角度1"}},[s._v("角度1")]),a("ul",[a("li",[a("a",{attrs:{href:"#mousemove-第一次触发"}},[s._v("mousemove 第一次触发")])]),a("li",[a("a",{attrs:{href:"#mousemove-第二次触发"}},[s._v("mousemove 第二次触发")])]),a("li",[a("a",{attrs:{href:"#mousemove-第五次触发"}},[s._v("mousemove 第五次触发")])]),a("li",[a("a",{attrs:{href:"#mousemove-停止触发"}},[s._v("mousemove 停止触发")])])])]),a("li",[a("a",{attrs:{href:"#角度-2"}},[s._v("角度 2")])]),a("li",[a("a",{attrs:{href:"#角度-3"}},[s._v("角度 3")])]),a("li",[a("a",{attrs:{href:"#角度-4"}},[s._v("角度 4")])]),a("li",[a("a",{attrs:{href:"#角度-5"}},[s._v("角度 5")])]),a("li",[a("a",{attrs:{href:"#角度-6"}},[s._v("角度 6")])]),a("li",[a("a",{attrs:{href:"#角度-7"}},[s._v("角度 7")])])])]),a("p"),s._v(" "),a("h1",{attrs:{id:"节流函数-throttle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节流函数-throttle","aria-hidden":"true"}},[s._v("#")]),s._v(" 节流函数 Throttle")]),s._v(" "),a("p",[s._v("我们先来看一张图，这张图充分说明了 "),a("code",[s._v("Throttle")]),s._v("（节流）和 "),a("code",[s._v("Debounce")]),s._v("（防抖）的区别，以及在不同配置下产生的不同效果，其中 "),a("code",[s._v("mousemove")]),s._v(" 事件每 50 ms 触发一次，即下图中的每一小隔是 50 ms。今天这篇文章就从下面这张图开始介绍。")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/images/prepare/know/1909141.jpg"),alt:"images/prepare/know/1909141.jpg"}}),s._v(" "),a("h2",{attrs:{id:"角度1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角度1","aria-hidden":"true"}},[s._v("#")]),s._v(" 角度1")]),s._v(" "),a("blockquote",[a("p",[s._v("lodash.throttle(fn, 200, {leading: true, trailing: true})")])]),s._v(" "),a("h3",{attrs:{id:"mousemove-第一次触发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mousemove-第一次触发","aria-hidden":"true"}},[s._v("#")]),s._v(" mousemove 第一次触发")]),s._v(" "),a("p",[s._v("先来看下 throttle 源码")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("throttle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 首尾调用默认为 true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" leading "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" trailing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typeof")]),s._v(" func "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'function'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TypeError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Expected a function'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// options 是否是对象")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    leading "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'leading'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" options "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("leading "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" leading\n    trailing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'trailing'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" options "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("trailing "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" trailing\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// maxWait 为 wait 的防抖函数")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("debounce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    leading"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    trailing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'maxWait'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("所以 "),a("code",[s._v("throttle(fn, 200, {leading: true, trailing: true})")]),s._v(" 返回内容是 "),a("code",[s._v("debounce(fn, 200, {leading: true, trailing: true, maxWait: 200})")]),s._v("，多了 "),a("code",[s._v("maxWait: 200")]),s._v(" 这部分。")]),s._v(" "),a("p",[s._v("先打个预防针，后面即将开始比较难的部分，看下 debounce 入口函数。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 入口函数，返回此函数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("debounced")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取当前时间")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 判断此时是否应该执行 func 函数")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" isInvoking "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shouldInvoke")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 赋值给闭包，用于其他函数调用")]),s._v("\n  lastArgs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" args\n  lastThis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),s._v("\n  lastCallTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isInvoking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 无 timerId 的情况有两种：")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1、首次调用 ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2、trailingEdge 执行过函数")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("leadingEdge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lastCallTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果设置了最大等待时间，则立即执行 func")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1、开启定时器，到时间后触发 trailingEdge 这个函数。")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2、执行 func，并返回结果")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maxing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 循环定时器中处理调用")]),s._v("\n      timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerExpired"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("invokeFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lastCallTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 一种特殊情况，trailing 设置为 true 时，前一个 wait 的 trailingEdge 已经执行了函数")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 此时函数被调用时 shouldInvoke 返回 false，所以要开启定时器")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerExpired"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不需要执行时，返回结果")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("p",[s._v("对于 "),a("code",[s._v("debounce(fn, 200, {leading: true, trailing: true, maxWait: 200})")]),s._v(" 来说，会经历如下过程。")]),s._v(" "),a("ul",[a("li",[s._v("1、"),a("code",[s._v("shouldInvoke(time)")]),s._v(" 中，因为满足条件 "),a("code",[s._v("lastCallTime === undefined")]),s._v("，所以返回 "),a("code",[s._v("true")])]),s._v(" "),a("li",[s._v("2、"),a("code",[s._v("lastCallTime = time")]),s._v("，所以 "),a("code",[s._v("lastCallTime")]),s._v(" 等于当前时间，假设为 0")]),s._v(" "),a("li",[s._v("3、"),a("code",[s._v("timerId === undefined")]),s._v(" 满足，执行 "),a("code",[s._v("leadingEdge(lastCallTime)")]),s._v(" 方法")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行连续事件刚开始的那次回调")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("leadingEdge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1、设置上一次执行 func 的时间")]),s._v("\n  lastInvokeTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2、开启定时器，为了事件结束后的那次回调")]),s._v("\n  timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerExpired"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3、如果配置了 leading 执行传入函数 func")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// leading 来源自 !!options.leading")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" leading "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("invokeFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" result\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ul",[a("li",[s._v("4、在 "),a("code",[s._v("leadingEdge(time)")]),s._v(" 中，设置 "),a("code",[s._v("lastInvokeTime")]),s._v(" 为当前时间即 0，开启 200 毫秒定时器，执行 "),a("code",[s._v("invokeFunc(time)")]),s._v(" 并返回")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行 Func 函数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("invokeFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取上一次执行 debounced 的参数")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" args "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lastArgs\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取上一次的 this")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" thisArg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lastThis\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 重置")]),s._v("\n  lastArgs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lastThis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v("\n  lastInvokeTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time\n  result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("thisArg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("ul",[a("li",[s._v("5、在 "),a("code",[s._v("invokeFunc(time)")]),s._v(" 中，执行 "),a("code",[s._v("func.apply(thisArg, args)")]),s._v("，即 fn 函数第一次执行，并把结果赋值给 "),a("code",[s._v("result")]),s._v("，便于后续触发时直接返回。同时重置 "),a("code",[s._v("lastInvokeTime")]),s._v(" 为当前时间即 0，清空 "),a("code",[s._v("lastArgs")]),s._v(" 和 "),a("code",[s._v("lastThis")]),s._v("。")]),s._v(" "),a("li",[s._v("6、第一次触发已经完成，注意此时 "),a("code",[s._v("lastCallTime")]),s._v(" 和 "),a("code",[s._v("lastInvokeTime")]),s._v(" 都为 0，200 毫秒的定时器还在运行中。")])]),s._v(" "),a("h3",{attrs:{id:"mousemove-第二次触发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mousemove-第二次触发","aria-hidden":"true"}},[s._v("#")]),s._v(" mousemove 第二次触发")]),s._v(" "),a("p",[s._v("50 毫秒后第二次触发到来，此时当前时间 "),a("code",[s._v("time")]),s._v(" 为 50，"),a("code",[s._v("wait")]),s._v(" 为 200，"),a("code",[s._v("maxWait")]),s._v(" 为 200，"),a("code",[s._v("maxing")]),s._v(" 为 true，"),a("code",[s._v("lastCallTime")]),s._v(" 和 "),a("code",[s._v("lastInvokeTime")]),s._v(" 都为 0，"),a("code",[s._v("timerId")]),s._v(" 定时器存在，我们来看下执行步骤。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shouldInvoke")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前时间距离上一次调用 debounce 的时间差")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" timeSinceLastCall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" lastCallTime\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前时间距离上一次执行 func 的时间差")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" timeSinceLastInvoke "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" lastInvokeTime\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 下述 4 种情况返回 true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" lastCallTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" \n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeSinceLastCall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeSinceLastCall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" \n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maxing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" timeSinceLastInvoke "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" maxWait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[s._v("1、shouldInvoke(time) 中，timeSinceLastCall 为 50，timeSinceLastInvoke 为 50，4 种条件都不满足，返回 false。")]),s._v(" "),a("li",[s._v("2、此时 isInvoking 为 false，同时 timerId === undefined 不满足，直接返回第一次触发时的 result")]),s._v(" "),a("li",[s._v("3、第二次触发完成，并不会执行 fn，只会返回上次执行的结果 result")]),s._v(" "),a("li",[s._v("4、第三次和第四次触发时，效果一样，就不再重复了。")])]),s._v(" "),a("h3",{attrs:{id:"mousemove-第五次触发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mousemove-第五次触发","aria-hidden":"true"}},[s._v("#")]),s._v(" mousemove 第五次触发")]),s._v(" "),a("p",[s._v("距第一次触发 200 毫秒后第五次触发到来，此时当前时间 "),a("code",[s._v("time")]),s._v(" 为 200，"),a("code",[s._v("wait")]),s._v(" 为 200， "),a("code",[s._v("maxWait")]),s._v(" 为 "),a("code",[s._v("200，maxing")]),s._v(" 为 true，"),a("code",[s._v("lastCallTime")]),s._v(" 为 150， "),a("code",[s._v("lastInvokeTime")]),s._v(" 为 "),a("code",[s._v("0，timerId")]),s._v(" 定时器存在，我们来看下执行步骤。")]),s._v(" "),a("ul",[a("li",[s._v("1、"),a("code",[s._v("shouldInvoke(time)")]),s._v(" 中，"),a("code",[s._v("timeSinceLastInvoke")]),s._v(" 为 200，满足 "),a("code",[s._v("(maxing && timeSinceLastInvoke >= maxWait)")]),s._v("，所以返回 true")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// debounced 方法中执行到这部分")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maxing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 循环定时器中处理调用")]),s._v("\n  timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerExpired"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("invokeFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lastCallTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("2、满足 maxing 条件，重新开启 200 毫秒的定时器，并执行 invokeFunc(lastCallTime) 函数")]),s._v(" "),a("li",[s._v("3、invokeFunc(time) 中，重置 lastInvokeTime 为当前时间即 200，清空 lastArgs 和 lastThis")]),s._v(" "),a("li",[s._v("4、第六、七、八次触发时，同第二次触发效果一致，就不再重复了。")])]),s._v(" "),a("h3",{attrs:{id:"mousemove-停止触发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mousemove-停止触发","aria-hidden":"true"}},[s._v("#")]),s._v(" mousemove 停止触发")]),s._v(" "),a("p",[s._v("假设第八次触发之后就停止了滚动，在第八次触发时 "),a("code",[s._v("time")]),s._v(" 为 350，所以如果有第九次触发，那么此时是应该执行fn 的，但是此时 "),a("code",[s._v("mousemove")]),s._v(" 已经停止了触发，那么还会执行 fn 吗？答案是依旧执行，因为最开始设置了 "),a("code",[s._v("{trailing: true}")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 开启定时器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("pendingFunc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wait")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 没传 wait 时调用 window.requestAnimationFrame()")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("useRAF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 若想在浏览器下次重绘之前继续更新下一帧动画")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 那么回调函数自身必须再次调用 window.requestAnimationFrame()")]),s._v("\n    root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cancelAnimationFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("requestAnimationFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pendingFunc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不使用 RAF 时开启定时器")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pendingFunc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("在第五次触发时开启了 200 毫秒的定时器，所以在时间 "),a("code",[s._v("time")]),s._v(" 到 400 时会执行 "),a("code",[s._v("pendingFunc")]),s._v("，此时的 "),a("code",[s._v("pendingFunc")]),s._v(" 就是 "),a("code",[s._v("timerExpired")]),s._v(" 函数，来看下具体的代码。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 定时器回调函数，表示定时结束后的操作")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timerExpired")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1、是否需要执行")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行事件结束后的那次回调，否则重启定时器")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shouldInvoke")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("trailingEdge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2、否则 计算剩余等待时间，重启定时器，保证下一次时延的末尾触发")]),s._v("\n  timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerExpired"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("remainingWait")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("此时在 "),a("code",[s._v("shouldInvoke(time)")]),s._v(" 中，"),a("code",[s._v("time")]),s._v(" 为 400，"),a("code",[s._v("lastInvokeTime")]),s._v(" 为 200，"),a("code",[s._v("timeSinceLastInvoke")]),s._v(" 为 200，满足 "),a("code",[s._v("(maxing && timeSinceLastInvoke >= maxWait)")]),s._v("，所以返回 true。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行连续事件结束后的那次回调")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("trailingEdge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 清空定时器")]),s._v("\n  timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// trailing 和 lastArgs 两者同时存在时执行")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// trailing 来源自 'trailing' in options ? !!options.trailing : trailing")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// lastArgs 标记位的作用，意味着 debounce 至少执行过一次")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trailing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" lastArgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("invokeFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 清空参数")]),s._v("\n  lastArgs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lastThis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("之后执行 "),a("code",[s._v("trailingEdge(time)")]),s._v("，在这个函数中判断 "),a("code",[s._v("trailing")]),s._v(" 和 "),a("code",[s._v("lastArgs")]),s._v(" ，此时这两个条件都是 true，所以会执行 "),a("code",[s._v("invokeFunc(time)")]),s._v("，最终执行函数 fn。")]),s._v(" "),a("p",[s._v("这里需要说明以下两点")]),s._v(" "),a("ol",[a("li",[s._v("如果设置了 "),a("code",[s._v("{trailing: false}")]),s._v("，那么最后一次是不会执行的。对于 "),a("code",[s._v("throttle")]),s._v(" 和 "),a("code",[s._v("debounce")]),s._v(" 来说，默认值是 true，所以如果没有特意指定 "),a("code",[s._v("trailing")]),s._v("，那么最后一次是一定会执行的。")]),s._v(" "),a("li",[s._v("对于 "),a("code",[s._v("lastArgs")]),s._v(" 来说，执行 "),a("code",[s._v("debounced")]),s._v(" 时会赋值，即每次触发都会重新赋值一次，那什么时候清空呢，在 "),a("code",[s._v("invokeFunc(time)")]),s._v(" 中执行 fn 函数时重置为 undefined，所以如果 "),a("code",[s._v("debounced")]),s._v(" 只触发了一次，即使设置了 "),a("code",[s._v("{trailing: true}")]),s._v(" 那也不会再执行 fn 函数，这个就解答了上篇文章留下的第一道思考题。")])]),s._v(" "),a("h2",{attrs:{id:"角度-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角度-2","aria-hidden":"true"}},[s._v("#")]),s._v(" 角度 2")]),s._v(" "),a("blockquote",[a("p",[s._v("lodash.throttle(fn, 200, {leading: true, trailing: false})")])]),s._v(" "),a("p",[s._v("在「角度 1 之 mousemove 停止触发」这部分中说到，如果不设置 "),a("code",[s._v("trailing")]),s._v(" 和设置 "),a("code",[s._v("{trailing: true}")]),s._v(" 效果是一样的，事件回调结束后都会再执行一次传入函数 fn，但是如果设置了"),a("code",[s._v("{trailing: false}")]),s._v("，那么事件回调结束后是不会再执行 fn 的。")]),s._v(" "),a("p",[s._v("此时的配置对比角度 1 来说，区别在于设置了"),a("code",[s._v("{trailing: false}")]),s._v("，所以实际效果对比 1 来说，就是最后不会额外再执行一次，效果见第一张图。")]),s._v(" "),a("h2",{attrs:{id:"角度-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角度-3","aria-hidden":"true"}},[s._v("#")]),s._v(" 角度 3")]),s._v(" "),a("blockquote",[a("p",[s._v("lodash.throttle(fn, 200, {leading: false, trailing: true})")])]),s._v(" "),a("p",[s._v("此时的配置和角度 1 相比，区别在于设置了 "),a("code",[s._v("{leading: false}")]),s._v("，所以直接看 "),a("code",[s._v("leadingEdge(time)")]),s._v(" 方法就可以了。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行连续事件刚开始的那次回调")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("leadingEdge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1、设置上一次执行 func 的时间")]),s._v("\n  lastInvokeTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2、开启定时器，为了事件结束后的那次回调")]),s._v("\n  timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerExpired"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3、如果配置了 leading 执行传入函数 func")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// leading 来源自 !!options.leading")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" leading "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("invokeFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" result\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("在这里，会开启 200 毫秒的定时器，同时因为 "),a("code",[s._v("leading")]),s._v(" 为 false，所以并不会执行 "),a("code",[s._v("invokeFunc(time)")]),s._v(" ，只会返回 result，此时的 result 值是 undefined。")]),s._v(" "),a("p",[s._v("这里开启一个定时器的目的是为了事件结束后的那次回调，即如果设置了 "),a("code",[s._v("{trailing: true}")]),s._v(" 那么最后一次回调将执行传入函数 fn，哪怕 debounced 函数只触发一次。")]),s._v(" "),a("p",[s._v("这里指定了 "),a("code",[s._v("{leading: false}")]),s._v("，那么 "),a("code",[s._v("leading")]),s._v(" 的初始值是什么呢？在 "),a("code",[s._v("debounce")]),s._v(" 中是 false，在 "),a("code",[s._v("throttle")]),s._v(" 中是 true。所以在 "),a("code",[s._v("throttle")]),s._v(" 中不需要刚开始就触发时，必须指定 "),a("code",[s._v("{leading: false}")]),s._v("，在 debounce 中就不需要了，默认不触发。")]),s._v(" "),a("h1",{attrs:{id:"防抖函数-debounce"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防抖函数-debounce","aria-hidden":"true"}},[s._v("#")]),s._v(" 防抖函数 Debounce")]),s._v(" "),a("h2",{attrs:{id:"角度-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角度-4","aria-hidden":"true"}},[s._v("#")]),s._v(" 角度 4")]),s._v(" "),a("blockquote",[a("p",[s._v("lodash.debounce(fn, 200, {leading: false, trailing: true})")])]),s._v(" "),a("p",[s._v("此时相比较 "),a("code",[s._v("throttle")]),s._v(" 来说，缺少了 "),a("code",[s._v("maxWait")]),s._v(" 值，所以具体触发过程中的判断就不一样了，来详细看一遍。")]),s._v(" "),a("ul",[a("li",[s._v("1、在入口函数 "),a("code",[s._v("debounced")]),s._v(" 中，执行 "),a("code",[s._v("shouldInvoke(time)")]),s._v("，前面讨论过因为第一次触发所以会返回 true，之后执行 "),a("code",[s._v("leadingEdge(lastCallTime)")]),s._v("。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行连续事件刚开始的那次回调")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("leadingEdge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1、设置上一次执行 func 的时间")]),s._v("\n  lastInvokeTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2、开启定时器，为了事件结束后的那次回调")]),s._v("\n  timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerExpired"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3、如果配置了 leading 执行传入函数 func")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// leading 来源自 !!options.leading")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" leading "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("invokeFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" result\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ul",[a("li",[s._v("2、在 "),a("code",[s._v("leadingEdge")]),s._v(" 中，因为 "),a("code",[s._v("leading")]),s._v(" 为 false，所以并不执行 fn，只开启 200 毫秒的定时器，并返回 undefined。此时 "),a("code",[s._v("lastInvokeTime")]),s._v(" 为当前时间，假设为 0。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 判断此时是否应该执行 func 函数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shouldInvoke")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前时间距离上一次调用 debounce 的时间差")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" timeSinceLastCall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" lastCallTime\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前时间距离上一次执行 func 的时间差")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" timeSinceLastInvoke "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" lastInvokeTime\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 下述 4 种情况返回 true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" lastCallTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" \n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeSinceLastCall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeSinceLastCall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" \n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maxing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" timeSinceLastInvoke "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" maxWait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("ul",[a("li",[s._v("3、之后每次触发时，"),a("code",[s._v("timeSinceLastCall")]),s._v(" 总是为 50 毫秒，"),a("code",[s._v("maxing")]),s._v(" 为 false，所以 "),a("code",[s._v("shouldInvoke(time)")]),s._v(" 总是返回 false，并不会执行传入函数 fn，只返回 result，即为 undefined。")]),s._v(" "),a("li",[s._v("4、到现在为止，fn 一次还没有执行，200 毫秒后，定时器回调函数触发，执行 "),a("code",[s._v("timerExpired")]),s._v(" 函数")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 定时器回调函数，表示定时结束后的操作")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timerExpired")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1、是否需要执行")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行事件结束后的那次回调，否则重启定时器")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shouldInvoke")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("trailingEdge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2、否则 计算剩余等待时间，重启定时器，保证下一次时延的末尾触发")]),s._v("\n  timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startTimer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timerExpired"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("remainingWait")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[s._v("5、此时存在两种情况，第一种是 "),a("code",[s._v("mousemove")]),s._v(" 事件一直在触发，根据前面介绍 "),a("code",[s._v("shouldInvoke(time)")]),s._v(" 会返回 false，之后就将计算剩余等待时间，重启定时器。时间计算公式为 "),a("code",[s._v("wait - (time - lastCallTime)")]),s._v("，即 200 - 50，所以只要 "),a("code",[s._v("shouldInvoke(time)")]),s._v(" 返回 false，就每隔 150 毫秒后执行一次 "),a("code",[s._v("timerExpired()")]),s._v("。")]),s._v(" "),a("li",[s._v("6、第二种情况是 "),a("code",[s._v("mousemove")]),s._v(" 事件不再触发，因为 "),a("code",[s._v("timerExpired()")]),s._v(" 在循环执行，所以肯定会存在一种情况满足 "),a("code",[s._v("timeSinceLastCall >= wait")]),s._v("，即 "),a("code",[s._v("shouldInvoke(time)")]),s._v(" 返回 true，终结 "),a("code",[s._v("timerExpired()")]),s._v(" 的循环，并执行 "),a("code",[s._v("trailingEdge(time)")]),s._v("。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行连续事件结束后的那次回调")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("trailingEdge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 清空定时器")]),s._v("\n  timerId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// trailing 和 lastArgs 两者同时存在时执行")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// trailing 来源自 'trailing' in options ? !!options.trailing : trailing")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// lastArgs 标记位的作用，意味着 debounce 至少执行过一次")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trailing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" lastArgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("invokeFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 清空参数")]),s._v("\n  lastArgs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lastThis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" result\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ul",[a("li",[s._v("7、在 "),a("code",[s._v("trailingEdge")]),s._v(" 中 "),a("code",[s._v("trailing")]),s._v(" 和 "),a("code",[s._v("lastArgs")]),s._v(" 都是 true，所以会执行 "),a("code",[s._v("invokeFunc(time)")]),s._v("，即执行传入函数 fn。\n8、所以整个过程中只在最后执行一次传入函数 fn，效果同上面第一张图所示。")])]),s._v(" "),a("h2",{attrs:{id:"角度-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角度-5","aria-hidden":"true"}},[s._v("#")]),s._v(" 角度 5")]),s._v(" "),a("blockquote",[a("p",[s._v("lodash.debounce(fn, 200, {leading: true, trailing: false})")])]),s._v(" "),a("p",[s._v("此时相比角度 4 来说，差异在于 "),a("code",[s._v("{leading: true, trailing: false}")]),s._v("，但是 "),a("code",[s._v("wait")]),s._v(" 和 "),a("code",[s._v("maxWait")]),s._v(" 都和角度 4 一致，所以只存在下面 2 种区别，效果同上面第一张图所示。")]),s._v(" "),a("ul",[a("li",[s._v("区别 1："),a("code",[s._v("leadingEdge")]),s._v(" 中会执行传入函数 fn")]),s._v(" "),a("li",[s._v("区别 2："),a("code",[s._v("trailingEdge")]),s._v(" 中不再执行传入函数 fn")])]),s._v(" "),a("h2",{attrs:{id:"角度-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角度-6","aria-hidden":"true"}},[s._v("#")]),s._v(" 角度 6")]),s._v(" "),a("blockquote",[a("p",[s._v("lodash.debounce(fn, 200, {leading: true, trailing: true})")])]),s._v(" "),a("p",[s._v("此时相比角度 4 来说，差异仅仅在于设置了 "),a("code",[s._v("{leading: true}")]),s._v("，所以只存在一个区别，那就是在 "),a("code",[s._v("leadingEdge")]),s._v(" 中会执行传入函数 fn，当然在 "),a("code",[s._v("trailingEdge")]),s._v(" 中依旧执行传入函数 fn，所以会出现在 "),a("code",[s._v("mousemove")]),s._v(" 事件触发过程中首尾都会执行的情况，效果同上面第一张图所示。")]),s._v(" "),a("p",[s._v("当然一种情况除外，那就是 "),a("code",[s._v("mousemove")]),s._v(" 事件永远只触发一次的情况，关键在于 "),a("code",[s._v("lastArgs")]),s._v(" 变量。")]),s._v(" "),a("p",[s._v("对于 "),a("code",[s._v("lastArgs")]),s._v(" 变量来说，在入口函数 "),a("code",[s._v("debounced")]),s._v(" 中赋值，即每次触发都会重新赋值一次，那什么时候清空呢，在 "),a("code",[s._v("invokeFunc(time)")]),s._v(" 中重置为 undefined，所以如果 "),a("code",[s._v("debounced")]),s._v(" 只触发了一次，而且在 "),a("code",[s._v("{leading: true}")]),s._v(" 时执行过一次 fn，那么即使设置了 "),a("code",[s._v("{trailing: true}")]),s._v(" 也不会再执行传入函数 fn。")]),s._v(" "),a("h2",{attrs:{id:"角度-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#角度-7","aria-hidden":"true"}},[s._v("#")]),s._v(" 角度 7")]),s._v(" "),a("blockquote",[a("p",[s._v("lodash.debounce(fn, 200, {leading: false, trailing: true, maxWait: 400})")])]),s._v(" "),a("p",[s._v("此时 "),a("code",[s._v("wait")]),s._v(" 为 200，"),a("code",[s._v("maxWait")]),s._v(" 为 400，maxing 为 true，我们来看下执行过程。")]),s._v(" "),a("ul",[a("li",[s._v("1、第一次触发时，因为 "),a("code",[s._v("{leading: false}")]),s._v("，所以肯定不会执行 fn，此时开启了一个 200 毫秒的定时器。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 判断此时是否应该执行 func 函数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shouldInvoke")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前时间距离上一次调用 debounce 的时间差")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" timeSinceLastCall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" lastCallTime\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前时间距离上一次执行 func 的时间差")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" timeSinceLastInvoke "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" lastInvokeTime\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 下述 4 种情况返回 true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" lastCallTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" \n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeSinceLastCall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeSinceLastCall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" \n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maxing "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" timeSinceLastInvoke "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" maxWait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("ul",[a("li",[s._v("2、之后每隔 50 毫秒触发一次，每次都会执行 "),a("code",[s._v("shouldInvoke(time)")]),s._v(" 函数，只有在第 400 毫秒时，才会满足 "),a("code",[s._v("maxing && timeSinceLastInvoke >= maxWait")]),s._v("，返回 true。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 计算仍需等待的时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("remainingWait")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前时间距离上一次调用 debounce 的时间差")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" timeSinceLastCall "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" lastCallTime\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 当前时间距离上一次执行 func 的时间差")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" timeSinceLastInvoke "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" lastInvokeTime\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 剩余等待时间")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" timeWaiting "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" wait "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" timeSinceLastCall\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否设置了最大等待时间")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是（节流）：返回「剩余等待时间」和「距上次执行 func 的剩余等待时间」中的最小值")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 否：返回剩余等待时间")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" maxing\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("min")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("timeWaiting"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" maxWait "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" timeSinceLastInvoke"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  \t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" timeWaiting\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ul",[a("li",[s._v("3、但是在这之前的第 200 毫秒，定时器触发回调函数，执行 "),a("code",[s._v("timerExpired")]),s._v("，因为此时 "),a("code",[s._v("shouldInvoke(time)")]),s._v(" 返回 false，所以会重新计算剩余等待时间并重启计时器，其中 "),a("code",[s._v("timeWaiting")]),s._v(" 是 150 毫秒，"),a("code",[s._v("maxWait - timeSinceLastInvoke")]),s._v(" 是 200 毫秒，所以计算结果是150 毫秒。")]),s._v(" "),a("li",[s._v("4、150 毫秒之后，即自开始之后的第 350 毫秒时，会重新计算时间，其中 "),a("code",[s._v("timeWaiting")]),s._v(" 依旧是 150 毫秒，"),a("code",[s._v("maxWait - timeSinceLastInvoke")]),s._v(" 是 50 毫秒，所以重新开启 50 毫秒的定时器，即在第 400 毫秒时触发。")]),s._v(" "),a("li",[s._v("5、此时会发现定时器触发的时间是第 400 毫秒，"),a("code",[s._v("shouldInvoke(time)")]),s._v(" 中返回 true 的时间也是在第 400 毫秒，为什么要这样呢？这样会冲突吗？首先定时器剩余时间判断和 "),a("code",[s._v("shouldInvoke(time)")]),s._v(" 判断中，只要有一处满足执行 fn 条件，就会立马执行，同时 "),a("code",[s._v("lastInvokeTime")]),s._v(" 值也会发生改变，所以另一处判断就不会生效了。另外本身定时器是不精准的，所以通过 "),a("code",[s._v("Math.min(timeWaiting, maxWait - timeSinceLastInvoke)")]),s._v(" 取最小值的方式来减少误差。")]),s._v(" "),a("li",[s._v("6、于此同时，需要在 "),a("code",[s._v("debounced")]),s._v(" 入口函数添加这么一句 "),a("code",[s._v("if (timerId === undefined) {timerId = startTimer(timerExpired, wait)}")]),s._v("，避免 "),a("code",[s._v("trailingEdge")]),s._v(" 执行后定时器被清空。")]),s._v(" "),a("li",[s._v("7、最终效果和节流是一样的，只是时间间隔变大了而已，具体效果同第一张图所示。")])])])}),[],!1,null,null,null);t.default=e.exports}}]);