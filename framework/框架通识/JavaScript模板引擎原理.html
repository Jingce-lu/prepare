<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript模板引擎原理，几行代码的事儿 | Lu notes</title>
    <meta name="description" content=" ">
    <link rel=" " href=" ">
    
    <link rel="preload" href="/prepare/assets/css/0.styles.c7089a63.css" as="style"><link rel="preload" href="/prepare/assets/js/styles.js" as="script"><link rel="preload" href="/prepare/assets/js/app.js" as="script"><link rel="preload" href="/prepare/assets/js/3.js" as="script"><link rel="preload" href="/prepare/assets/js/2.js" as="script"><link rel="preload" href="/prepare/assets/js/219.js" as="script"><link rel="prefetch" href="/prepare/assets/js/10.js"><link rel="prefetch" href="/prepare/assets/js/100.js"><link rel="prefetch" href="/prepare/assets/js/101.js"><link rel="prefetch" href="/prepare/assets/js/102.js"><link rel="prefetch" href="/prepare/assets/js/103.js"><link rel="prefetch" href="/prepare/assets/js/104.js"><link rel="prefetch" href="/prepare/assets/js/105.js"><link rel="prefetch" href="/prepare/assets/js/106.js"><link rel="prefetch" href="/prepare/assets/js/107.js"><link rel="prefetch" href="/prepare/assets/js/108.js"><link rel="prefetch" href="/prepare/assets/js/109.js"><link rel="prefetch" href="/prepare/assets/js/11.js"><link rel="prefetch" href="/prepare/assets/js/110.js"><link rel="prefetch" href="/prepare/assets/js/111.js"><link rel="prefetch" href="/prepare/assets/js/112.js"><link rel="prefetch" href="/prepare/assets/js/113.js"><link rel="prefetch" href="/prepare/assets/js/114.js"><link rel="prefetch" href="/prepare/assets/js/115.js"><link rel="prefetch" href="/prepare/assets/js/116.js"><link rel="prefetch" href="/prepare/assets/js/117.js"><link rel="prefetch" href="/prepare/assets/js/118.js"><link rel="prefetch" href="/prepare/assets/js/119.js"><link rel="prefetch" href="/prepare/assets/js/12.js"><link rel="prefetch" href="/prepare/assets/js/120.js"><link rel="prefetch" href="/prepare/assets/js/121.js"><link rel="prefetch" href="/prepare/assets/js/122.js"><link rel="prefetch" href="/prepare/assets/js/123.js"><link rel="prefetch" href="/prepare/assets/js/124.js"><link rel="prefetch" href="/prepare/assets/js/125.js"><link rel="prefetch" href="/prepare/assets/js/126.js"><link rel="prefetch" href="/prepare/assets/js/127.js"><link rel="prefetch" href="/prepare/assets/js/128.js"><link rel="prefetch" href="/prepare/assets/js/129.js"><link rel="prefetch" href="/prepare/assets/js/13.js"><link rel="prefetch" href="/prepare/assets/js/130.js"><link rel="prefetch" href="/prepare/assets/js/131.js"><link rel="prefetch" href="/prepare/assets/js/132.js"><link rel="prefetch" href="/prepare/assets/js/133.js"><link rel="prefetch" href="/prepare/assets/js/134.js"><link rel="prefetch" href="/prepare/assets/js/135.js"><link rel="prefetch" href="/prepare/assets/js/136.js"><link rel="prefetch" href="/prepare/assets/js/137.js"><link rel="prefetch" href="/prepare/assets/js/138.js"><link rel="prefetch" href="/prepare/assets/js/139.js"><link rel="prefetch" href="/prepare/assets/js/14.js"><link rel="prefetch" href="/prepare/assets/js/140.js"><link rel="prefetch" href="/prepare/assets/js/141.js"><link rel="prefetch" href="/prepare/assets/js/142.js"><link rel="prefetch" href="/prepare/assets/js/143.js"><link rel="prefetch" href="/prepare/assets/js/144.js"><link rel="prefetch" href="/prepare/assets/js/145.js"><link rel="prefetch" href="/prepare/assets/js/146.js"><link rel="prefetch" href="/prepare/assets/js/147.js"><link rel="prefetch" href="/prepare/assets/js/148.js"><link rel="prefetch" href="/prepare/assets/js/149.js"><link rel="prefetch" href="/prepare/assets/js/15.js"><link rel="prefetch" href="/prepare/assets/js/150.js"><link rel="prefetch" href="/prepare/assets/js/151.js"><link rel="prefetch" href="/prepare/assets/js/152.js"><link rel="prefetch" href="/prepare/assets/js/153.js"><link rel="prefetch" href="/prepare/assets/js/154.js"><link rel="prefetch" href="/prepare/assets/js/155.js"><link rel="prefetch" href="/prepare/assets/js/156.js"><link rel="prefetch" href="/prepare/assets/js/157.js"><link rel="prefetch" href="/prepare/assets/js/158.js"><link rel="prefetch" href="/prepare/assets/js/159.js"><link rel="prefetch" href="/prepare/assets/js/16.js"><link rel="prefetch" href="/prepare/assets/js/160.js"><link rel="prefetch" href="/prepare/assets/js/161.js"><link rel="prefetch" href="/prepare/assets/js/162.js"><link rel="prefetch" href="/prepare/assets/js/163.js"><link rel="prefetch" href="/prepare/assets/js/164.js"><link rel="prefetch" href="/prepare/assets/js/165.js"><link rel="prefetch" href="/prepare/assets/js/166.js"><link rel="prefetch" href="/prepare/assets/js/167.js"><link rel="prefetch" href="/prepare/assets/js/168.js"><link rel="prefetch" href="/prepare/assets/js/169.js"><link rel="prefetch" href="/prepare/assets/js/17.js"><link rel="prefetch" href="/prepare/assets/js/170.js"><link rel="prefetch" href="/prepare/assets/js/171.js"><link rel="prefetch" href="/prepare/assets/js/172.js"><link rel="prefetch" href="/prepare/assets/js/173.js"><link rel="prefetch" href="/prepare/assets/js/174.js"><link rel="prefetch" href="/prepare/assets/js/175.js"><link rel="prefetch" href="/prepare/assets/js/176.js"><link rel="prefetch" href="/prepare/assets/js/177.js"><link rel="prefetch" href="/prepare/assets/js/178.js"><link rel="prefetch" href="/prepare/assets/js/179.js"><link rel="prefetch" href="/prepare/assets/js/18.js"><link rel="prefetch" href="/prepare/assets/js/180.js"><link rel="prefetch" href="/prepare/assets/js/181.js"><link rel="prefetch" href="/prepare/assets/js/182.js"><link rel="prefetch" href="/prepare/assets/js/183.js"><link rel="prefetch" href="/prepare/assets/js/184.js"><link rel="prefetch" href="/prepare/assets/js/185.js"><link rel="prefetch" href="/prepare/assets/js/186.js"><link rel="prefetch" href="/prepare/assets/js/187.js"><link rel="prefetch" href="/prepare/assets/js/188.js"><link rel="prefetch" href="/prepare/assets/js/189.js"><link rel="prefetch" href="/prepare/assets/js/19.js"><link rel="prefetch" href="/prepare/assets/js/190.js"><link rel="prefetch" href="/prepare/assets/js/191.js"><link rel="prefetch" href="/prepare/assets/js/192.js"><link rel="prefetch" href="/prepare/assets/js/193.js"><link rel="prefetch" href="/prepare/assets/js/194.js"><link rel="prefetch" href="/prepare/assets/js/195.js"><link rel="prefetch" href="/prepare/assets/js/196.js"><link rel="prefetch" href="/prepare/assets/js/197.js"><link rel="prefetch" href="/prepare/assets/js/198.js"><link rel="prefetch" href="/prepare/assets/js/199.js"><link rel="prefetch" href="/prepare/assets/js/20.js"><link rel="prefetch" href="/prepare/assets/js/200.js"><link rel="prefetch" href="/prepare/assets/js/201.js"><link rel="prefetch" href="/prepare/assets/js/202.js"><link rel="prefetch" href="/prepare/assets/js/203.js"><link rel="prefetch" href="/prepare/assets/js/204.js"><link rel="prefetch" href="/prepare/assets/js/205.js"><link rel="prefetch" href="/prepare/assets/js/206.js"><link rel="prefetch" href="/prepare/assets/js/207.js"><link rel="prefetch" href="/prepare/assets/js/208.js"><link rel="prefetch" href="/prepare/assets/js/209.js"><link rel="prefetch" href="/prepare/assets/js/21.js"><link rel="prefetch" href="/prepare/assets/js/210.js"><link rel="prefetch" href="/prepare/assets/js/211.js"><link rel="prefetch" href="/prepare/assets/js/212.js"><link rel="prefetch" href="/prepare/assets/js/213.js"><link rel="prefetch" href="/prepare/assets/js/214.js"><link rel="prefetch" href="/prepare/assets/js/215.js"><link rel="prefetch" href="/prepare/assets/js/216.js"><link rel="prefetch" href="/prepare/assets/js/217.js"><link rel="prefetch" href="/prepare/assets/js/218.js"><link rel="prefetch" href="/prepare/assets/js/22.js"><link rel="prefetch" href="/prepare/assets/js/220.js"><link rel="prefetch" href="/prepare/assets/js/221.js"><link rel="prefetch" href="/prepare/assets/js/222.js"><link rel="prefetch" href="/prepare/assets/js/223.js"><link rel="prefetch" href="/prepare/assets/js/224.js"><link rel="prefetch" href="/prepare/assets/js/225.js"><link rel="prefetch" href="/prepare/assets/js/226.js"><link rel="prefetch" href="/prepare/assets/js/227.js"><link rel="prefetch" href="/prepare/assets/js/228.js"><link rel="prefetch" href="/prepare/assets/js/229.js"><link rel="prefetch" href="/prepare/assets/js/23.js"><link rel="prefetch" href="/prepare/assets/js/230.js"><link rel="prefetch" href="/prepare/assets/js/231.js"><link rel="prefetch" href="/prepare/assets/js/232.js"><link rel="prefetch" href="/prepare/assets/js/233.js"><link rel="prefetch" href="/prepare/assets/js/234.js"><link rel="prefetch" href="/prepare/assets/js/235.js"><link rel="prefetch" href="/prepare/assets/js/236.js"><link rel="prefetch" href="/prepare/assets/js/237.js"><link rel="prefetch" href="/prepare/assets/js/238.js"><link rel="prefetch" href="/prepare/assets/js/239.js"><link rel="prefetch" href="/prepare/assets/js/24.js"><link rel="prefetch" href="/prepare/assets/js/240.js"><link rel="prefetch" href="/prepare/assets/js/241.js"><link rel="prefetch" href="/prepare/assets/js/242.js"><link rel="prefetch" href="/prepare/assets/js/243.js"><link rel="prefetch" href="/prepare/assets/js/244.js"><link rel="prefetch" href="/prepare/assets/js/245.js"><link rel="prefetch" href="/prepare/assets/js/246.js"><link rel="prefetch" href="/prepare/assets/js/247.js"><link rel="prefetch" href="/prepare/assets/js/248.js"><link rel="prefetch" href="/prepare/assets/js/249.js"><link rel="prefetch" href="/prepare/assets/js/25.js"><link rel="prefetch" href="/prepare/assets/js/250.js"><link rel="prefetch" href="/prepare/assets/js/251.js"><link rel="prefetch" href="/prepare/assets/js/252.js"><link rel="prefetch" href="/prepare/assets/js/253.js"><link rel="prefetch" href="/prepare/assets/js/254.js"><link rel="prefetch" href="/prepare/assets/js/255.js"><link rel="prefetch" href="/prepare/assets/js/256.js"><link rel="prefetch" href="/prepare/assets/js/257.js"><link rel="prefetch" href="/prepare/assets/js/258.js"><link rel="prefetch" href="/prepare/assets/js/259.js"><link rel="prefetch" href="/prepare/assets/js/26.js"><link rel="prefetch" href="/prepare/assets/js/260.js"><link rel="prefetch" href="/prepare/assets/js/261.js"><link rel="prefetch" href="/prepare/assets/js/262.js"><link rel="prefetch" href="/prepare/assets/js/263.js"><link rel="prefetch" href="/prepare/assets/js/264.js"><link rel="prefetch" href="/prepare/assets/js/265.js"><link rel="prefetch" href="/prepare/assets/js/266.js"><link rel="prefetch" href="/prepare/assets/js/267.js"><link rel="prefetch" href="/prepare/assets/js/268.js"><link rel="prefetch" href="/prepare/assets/js/269.js"><link rel="prefetch" href="/prepare/assets/js/27.js"><link rel="prefetch" href="/prepare/assets/js/270.js"><link rel="prefetch" href="/prepare/assets/js/271.js"><link rel="prefetch" href="/prepare/assets/js/272.js"><link rel="prefetch" href="/prepare/assets/js/273.js"><link rel="prefetch" href="/prepare/assets/js/274.js"><link rel="prefetch" href="/prepare/assets/js/275.js"><link rel="prefetch" href="/prepare/assets/js/276.js"><link rel="prefetch" href="/prepare/assets/js/277.js"><link rel="prefetch" href="/prepare/assets/js/278.js"><link rel="prefetch" href="/prepare/assets/js/279.js"><link rel="prefetch" href="/prepare/assets/js/28.js"><link rel="prefetch" href="/prepare/assets/js/280.js"><link rel="prefetch" href="/prepare/assets/js/281.js"><link rel="prefetch" href="/prepare/assets/js/282.js"><link rel="prefetch" href="/prepare/assets/js/283.js"><link rel="prefetch" href="/prepare/assets/js/284.js"><link rel="prefetch" href="/prepare/assets/js/285.js"><link rel="prefetch" href="/prepare/assets/js/286.js"><link rel="prefetch" href="/prepare/assets/js/287.js"><link rel="prefetch" href="/prepare/assets/js/288.js"><link rel="prefetch" href="/prepare/assets/js/289.js"><link rel="prefetch" href="/prepare/assets/js/29.js"><link rel="prefetch" href="/prepare/assets/js/290.js"><link rel="prefetch" href="/prepare/assets/js/291.js"><link rel="prefetch" href="/prepare/assets/js/292.js"><link rel="prefetch" href="/prepare/assets/js/293.js"><link rel="prefetch" href="/prepare/assets/js/294.js"><link rel="prefetch" href="/prepare/assets/js/295.js"><link rel="prefetch" href="/prepare/assets/js/296.js"><link rel="prefetch" href="/prepare/assets/js/297.js"><link rel="prefetch" href="/prepare/assets/js/298.js"><link rel="prefetch" href="/prepare/assets/js/299.js"><link rel="prefetch" href="/prepare/assets/js/30.js"><link rel="prefetch" href="/prepare/assets/js/300.js"><link rel="prefetch" href="/prepare/assets/js/301.js"><link rel="prefetch" href="/prepare/assets/js/302.js"><link rel="prefetch" href="/prepare/assets/js/303.js"><link rel="prefetch" href="/prepare/assets/js/304.js"><link rel="prefetch" href="/prepare/assets/js/305.js"><link rel="prefetch" href="/prepare/assets/js/306.js"><link rel="prefetch" href="/prepare/assets/js/307.js"><link rel="prefetch" href="/prepare/assets/js/308.js"><link rel="prefetch" href="/prepare/assets/js/309.js"><link rel="prefetch" href="/prepare/assets/js/31.js"><link rel="prefetch" href="/prepare/assets/js/310.js"><link rel="prefetch" href="/prepare/assets/js/311.js"><link rel="prefetch" href="/prepare/assets/js/312.js"><link rel="prefetch" href="/prepare/assets/js/313.js"><link rel="prefetch" href="/prepare/assets/js/314.js"><link rel="prefetch" href="/prepare/assets/js/315.js"><link rel="prefetch" href="/prepare/assets/js/316.js"><link rel="prefetch" href="/prepare/assets/js/317.js"><link rel="prefetch" href="/prepare/assets/js/318.js"><link rel="prefetch" href="/prepare/assets/js/319.js"><link rel="prefetch" href="/prepare/assets/js/32.js"><link rel="prefetch" href="/prepare/assets/js/320.js"><link rel="prefetch" href="/prepare/assets/js/321.js"><link rel="prefetch" href="/prepare/assets/js/322.js"><link rel="prefetch" href="/prepare/assets/js/323.js"><link rel="prefetch" href="/prepare/assets/js/324.js"><link rel="prefetch" href="/prepare/assets/js/325.js"><link rel="prefetch" href="/prepare/assets/js/326.js"><link rel="prefetch" href="/prepare/assets/js/327.js"><link rel="prefetch" href="/prepare/assets/js/328.js"><link rel="prefetch" href="/prepare/assets/js/329.js"><link rel="prefetch" href="/prepare/assets/js/33.js"><link rel="prefetch" href="/prepare/assets/js/330.js"><link rel="prefetch" href="/prepare/assets/js/331.js"><link rel="prefetch" href="/prepare/assets/js/332.js"><link rel="prefetch" href="/prepare/assets/js/333.js"><link rel="prefetch" href="/prepare/assets/js/334.js"><link rel="prefetch" href="/prepare/assets/js/335.js"><link rel="prefetch" href="/prepare/assets/js/336.js"><link rel="prefetch" href="/prepare/assets/js/337.js"><link rel="prefetch" href="/prepare/assets/js/338.js"><link rel="prefetch" href="/prepare/assets/js/339.js"><link rel="prefetch" href="/prepare/assets/js/34.js"><link rel="prefetch" href="/prepare/assets/js/340.js"><link rel="prefetch" href="/prepare/assets/js/341.js"><link rel="prefetch" href="/prepare/assets/js/342.js"><link rel="prefetch" href="/prepare/assets/js/343.js"><link rel="prefetch" href="/prepare/assets/js/344.js"><link rel="prefetch" href="/prepare/assets/js/345.js"><link rel="prefetch" href="/prepare/assets/js/346.js"><link rel="prefetch" href="/prepare/assets/js/347.js"><link rel="prefetch" href="/prepare/assets/js/348.js"><link rel="prefetch" href="/prepare/assets/js/349.js"><link rel="prefetch" href="/prepare/assets/js/35.js"><link rel="prefetch" href="/prepare/assets/js/350.js"><link rel="prefetch" href="/prepare/assets/js/351.js"><link rel="prefetch" href="/prepare/assets/js/352.js"><link rel="prefetch" href="/prepare/assets/js/353.js"><link rel="prefetch" href="/prepare/assets/js/354.js"><link rel="prefetch" href="/prepare/assets/js/355.js"><link rel="prefetch" href="/prepare/assets/js/356.js"><link rel="prefetch" href="/prepare/assets/js/357.js"><link rel="prefetch" href="/prepare/assets/js/358.js"><link rel="prefetch" href="/prepare/assets/js/359.js"><link rel="prefetch" href="/prepare/assets/js/36.js"><link rel="prefetch" href="/prepare/assets/js/360.js"><link rel="prefetch" href="/prepare/assets/js/361.js"><link rel="prefetch" href="/prepare/assets/js/362.js"><link rel="prefetch" href="/prepare/assets/js/363.js"><link rel="prefetch" href="/prepare/assets/js/364.js"><link rel="prefetch" href="/prepare/assets/js/365.js"><link rel="prefetch" href="/prepare/assets/js/366.js"><link rel="prefetch" href="/prepare/assets/js/367.js"><link rel="prefetch" href="/prepare/assets/js/368.js"><link rel="prefetch" href="/prepare/assets/js/369.js"><link rel="prefetch" href="/prepare/assets/js/37.js"><link rel="prefetch" href="/prepare/assets/js/370.js"><link rel="prefetch" href="/prepare/assets/js/371.js"><link rel="prefetch" href="/prepare/assets/js/372.js"><link rel="prefetch" href="/prepare/assets/js/373.js"><link rel="prefetch" href="/prepare/assets/js/374.js"><link rel="prefetch" href="/prepare/assets/js/375.js"><link rel="prefetch" href="/prepare/assets/js/376.js"><link rel="prefetch" href="/prepare/assets/js/377.js"><link rel="prefetch" href="/prepare/assets/js/378.js"><link rel="prefetch" href="/prepare/assets/js/379.js"><link rel="prefetch" href="/prepare/assets/js/38.js"><link rel="prefetch" href="/prepare/assets/js/380.js"><link rel="prefetch" href="/prepare/assets/js/381.js"><link rel="prefetch" href="/prepare/assets/js/382.js"><link rel="prefetch" href="/prepare/assets/js/383.js"><link rel="prefetch" href="/prepare/assets/js/384.js"><link rel="prefetch" href="/prepare/assets/js/385.js"><link rel="prefetch" href="/prepare/assets/js/386.js"><link rel="prefetch" href="/prepare/assets/js/387.js"><link rel="prefetch" href="/prepare/assets/js/388.js"><link rel="prefetch" href="/prepare/assets/js/389.js"><link rel="prefetch" href="/prepare/assets/js/39.js"><link rel="prefetch" href="/prepare/assets/js/390.js"><link rel="prefetch" href="/prepare/assets/js/391.js"><link rel="prefetch" href="/prepare/assets/js/392.js"><link rel="prefetch" href="/prepare/assets/js/393.js"><link rel="prefetch" href="/prepare/assets/js/394.js"><link rel="prefetch" href="/prepare/assets/js/395.js"><link rel="prefetch" href="/prepare/assets/js/396.js"><link rel="prefetch" href="/prepare/assets/js/397.js"><link rel="prefetch" href="/prepare/assets/js/398.js"><link rel="prefetch" href="/prepare/assets/js/399.js"><link rel="prefetch" href="/prepare/assets/js/4.js"><link rel="prefetch" href="/prepare/assets/js/40.js"><link rel="prefetch" href="/prepare/assets/js/400.js"><link rel="prefetch" href="/prepare/assets/js/401.js"><link rel="prefetch" href="/prepare/assets/js/402.js"><link rel="prefetch" href="/prepare/assets/js/403.js"><link rel="prefetch" href="/prepare/assets/js/404.js"><link rel="prefetch" href="/prepare/assets/js/405.js"><link rel="prefetch" href="/prepare/assets/js/406.js"><link rel="prefetch" href="/prepare/assets/js/407.js"><link rel="prefetch" href="/prepare/assets/js/408.js"><link rel="prefetch" href="/prepare/assets/js/409.js"><link rel="prefetch" href="/prepare/assets/js/41.js"><link rel="prefetch" href="/prepare/assets/js/410.js"><link rel="prefetch" href="/prepare/assets/js/411.js"><link rel="prefetch" href="/prepare/assets/js/412.js"><link rel="prefetch" href="/prepare/assets/js/413.js"><link rel="prefetch" href="/prepare/assets/js/414.js"><link rel="prefetch" href="/prepare/assets/js/415.js"><link rel="prefetch" href="/prepare/assets/js/416.js"><link rel="prefetch" href="/prepare/assets/js/417.js"><link rel="prefetch" href="/prepare/assets/js/418.js"><link rel="prefetch" href="/prepare/assets/js/419.js"><link rel="prefetch" href="/prepare/assets/js/42.js"><link rel="prefetch" href="/prepare/assets/js/420.js"><link rel="prefetch" href="/prepare/assets/js/421.js"><link rel="prefetch" href="/prepare/assets/js/422.js"><link rel="prefetch" href="/prepare/assets/js/423.js"><link rel="prefetch" href="/prepare/assets/js/424.js"><link rel="prefetch" href="/prepare/assets/js/425.js"><link rel="prefetch" href="/prepare/assets/js/426.js"><link rel="prefetch" href="/prepare/assets/js/427.js"><link rel="prefetch" href="/prepare/assets/js/428.js"><link rel="prefetch" href="/prepare/assets/js/429.js"><link rel="prefetch" href="/prepare/assets/js/43.js"><link rel="prefetch" href="/prepare/assets/js/430.js"><link rel="prefetch" href="/prepare/assets/js/431.js"><link rel="prefetch" href="/prepare/assets/js/432.js"><link rel="prefetch" href="/prepare/assets/js/433.js"><link rel="prefetch" href="/prepare/assets/js/434.js"><link rel="prefetch" href="/prepare/assets/js/435.js"><link rel="prefetch" href="/prepare/assets/js/436.js"><link rel="prefetch" href="/prepare/assets/js/437.js"><link rel="prefetch" href="/prepare/assets/js/438.js"><link rel="prefetch" href="/prepare/assets/js/439.js"><link rel="prefetch" href="/prepare/assets/js/44.js"><link rel="prefetch" href="/prepare/assets/js/440.js"><link rel="prefetch" href="/prepare/assets/js/441.js"><link rel="prefetch" href="/prepare/assets/js/442.js"><link rel="prefetch" href="/prepare/assets/js/443.js"><link rel="prefetch" href="/prepare/assets/js/444.js"><link rel="prefetch" href="/prepare/assets/js/445.js"><link rel="prefetch" href="/prepare/assets/js/446.js"><link rel="prefetch" href="/prepare/assets/js/447.js"><link rel="prefetch" href="/prepare/assets/js/448.js"><link rel="prefetch" href="/prepare/assets/js/449.js"><link rel="prefetch" href="/prepare/assets/js/45.js"><link rel="prefetch" href="/prepare/assets/js/450.js"><link rel="prefetch" href="/prepare/assets/js/451.js"><link rel="prefetch" href="/prepare/assets/js/452.js"><link rel="prefetch" href="/prepare/assets/js/453.js"><link rel="prefetch" href="/prepare/assets/js/454.js"><link rel="prefetch" href="/prepare/assets/js/455.js"><link rel="prefetch" href="/prepare/assets/js/456.js"><link rel="prefetch" href="/prepare/assets/js/457.js"><link rel="prefetch" href="/prepare/assets/js/458.js"><link rel="prefetch" href="/prepare/assets/js/459.js"><link rel="prefetch" href="/prepare/assets/js/46.js"><link rel="prefetch" href="/prepare/assets/js/460.js"><link rel="prefetch" href="/prepare/assets/js/461.js"><link rel="prefetch" href="/prepare/assets/js/462.js"><link rel="prefetch" href="/prepare/assets/js/463.js"><link rel="prefetch" href="/prepare/assets/js/464.js"><link rel="prefetch" href="/prepare/assets/js/465.js"><link rel="prefetch" href="/prepare/assets/js/466.js"><link rel="prefetch" href="/prepare/assets/js/467.js"><link rel="prefetch" href="/prepare/assets/js/468.js"><link rel="prefetch" href="/prepare/assets/js/469.js"><link rel="prefetch" href="/prepare/assets/js/47.js"><link rel="prefetch" href="/prepare/assets/js/470.js"><link rel="prefetch" href="/prepare/assets/js/471.js"><link rel="prefetch" href="/prepare/assets/js/472.js"><link rel="prefetch" href="/prepare/assets/js/473.js"><link rel="prefetch" href="/prepare/assets/js/474.js"><link rel="prefetch" href="/prepare/assets/js/475.js"><link rel="prefetch" href="/prepare/assets/js/476.js"><link rel="prefetch" href="/prepare/assets/js/477.js"><link rel="prefetch" href="/prepare/assets/js/478.js"><link rel="prefetch" href="/prepare/assets/js/479.js"><link rel="prefetch" href="/prepare/assets/js/48.js"><link rel="prefetch" href="/prepare/assets/js/480.js"><link rel="prefetch" href="/prepare/assets/js/481.js"><link rel="prefetch" href="/prepare/assets/js/482.js"><link rel="prefetch" href="/prepare/assets/js/483.js"><link rel="prefetch" href="/prepare/assets/js/484.js"><link rel="prefetch" href="/prepare/assets/js/485.js"><link rel="prefetch" href="/prepare/assets/js/486.js"><link rel="prefetch" href="/prepare/assets/js/487.js"><link rel="prefetch" href="/prepare/assets/js/488.js"><link rel="prefetch" href="/prepare/assets/js/489.js"><link rel="prefetch" href="/prepare/assets/js/49.js"><link rel="prefetch" href="/prepare/assets/js/490.js"><link rel="prefetch" href="/prepare/assets/js/491.js"><link rel="prefetch" href="/prepare/assets/js/492.js"><link rel="prefetch" href="/prepare/assets/js/493.js"><link rel="prefetch" href="/prepare/assets/js/494.js"><link rel="prefetch" href="/prepare/assets/js/495.js"><link rel="prefetch" href="/prepare/assets/js/496.js"><link rel="prefetch" href="/prepare/assets/js/497.js"><link rel="prefetch" href="/prepare/assets/js/498.js"><link rel="prefetch" href="/prepare/assets/js/499.js"><link rel="prefetch" href="/prepare/assets/js/5.js"><link rel="prefetch" href="/prepare/assets/js/50.js"><link rel="prefetch" href="/prepare/assets/js/500.js"><link rel="prefetch" href="/prepare/assets/js/501.js"><link rel="prefetch" href="/prepare/assets/js/502.js"><link rel="prefetch" href="/prepare/assets/js/503.js"><link rel="prefetch" href="/prepare/assets/js/504.js"><link rel="prefetch" href="/prepare/assets/js/505.js"><link rel="prefetch" href="/prepare/assets/js/506.js"><link rel="prefetch" href="/prepare/assets/js/507.js"><link rel="prefetch" href="/prepare/assets/js/508.js"><link rel="prefetch" href="/prepare/assets/js/509.js"><link rel="prefetch" href="/prepare/assets/js/51.js"><link rel="prefetch" href="/prepare/assets/js/510.js"><link rel="prefetch" href="/prepare/assets/js/511.js"><link rel="prefetch" href="/prepare/assets/js/512.js"><link rel="prefetch" href="/prepare/assets/js/513.js"><link rel="prefetch" href="/prepare/assets/js/514.js"><link rel="prefetch" href="/prepare/assets/js/515.js"><link rel="prefetch" href="/prepare/assets/js/516.js"><link rel="prefetch" href="/prepare/assets/js/517.js"><link rel="prefetch" href="/prepare/assets/js/518.js"><link rel="prefetch" href="/prepare/assets/js/519.js"><link rel="prefetch" href="/prepare/assets/js/52.js"><link rel="prefetch" href="/prepare/assets/js/520.js"><link rel="prefetch" href="/prepare/assets/js/521.js"><link rel="prefetch" href="/prepare/assets/js/522.js"><link rel="prefetch" href="/prepare/assets/js/523.js"><link rel="prefetch" href="/prepare/assets/js/524.js"><link rel="prefetch" href="/prepare/assets/js/525.js"><link rel="prefetch" href="/prepare/assets/js/526.js"><link rel="prefetch" href="/prepare/assets/js/527.js"><link rel="prefetch" href="/prepare/assets/js/528.js"><link rel="prefetch" href="/prepare/assets/js/529.js"><link rel="prefetch" href="/prepare/assets/js/53.js"><link rel="prefetch" href="/prepare/assets/js/530.js"><link rel="prefetch" href="/prepare/assets/js/531.js"><link rel="prefetch" href="/prepare/assets/js/532.js"><link rel="prefetch" href="/prepare/assets/js/533.js"><link rel="prefetch" href="/prepare/assets/js/534.js"><link rel="prefetch" href="/prepare/assets/js/535.js"><link rel="prefetch" href="/prepare/assets/js/536.js"><link rel="prefetch" href="/prepare/assets/js/537.js"><link rel="prefetch" href="/prepare/assets/js/538.js"><link rel="prefetch" href="/prepare/assets/js/539.js"><link rel="prefetch" href="/prepare/assets/js/54.js"><link rel="prefetch" href="/prepare/assets/js/540.js"><link rel="prefetch" href="/prepare/assets/js/541.js"><link rel="prefetch" href="/prepare/assets/js/542.js"><link rel="prefetch" href="/prepare/assets/js/543.js"><link rel="prefetch" href="/prepare/assets/js/544.js"><link rel="prefetch" href="/prepare/assets/js/545.js"><link rel="prefetch" href="/prepare/assets/js/546.js"><link rel="prefetch" href="/prepare/assets/js/547.js"><link rel="prefetch" href="/prepare/assets/js/548.js"><link rel="prefetch" href="/prepare/assets/js/549.js"><link rel="prefetch" href="/prepare/assets/js/55.js"><link rel="prefetch" href="/prepare/assets/js/550.js"><link rel="prefetch" href="/prepare/assets/js/551.js"><link rel="prefetch" href="/prepare/assets/js/552.js"><link rel="prefetch" href="/prepare/assets/js/553.js"><link rel="prefetch" href="/prepare/assets/js/554.js"><link rel="prefetch" href="/prepare/assets/js/555.js"><link rel="prefetch" href="/prepare/assets/js/556.js"><link rel="prefetch" href="/prepare/assets/js/557.js"><link rel="prefetch" href="/prepare/assets/js/558.js"><link rel="prefetch" href="/prepare/assets/js/559.js"><link rel="prefetch" href="/prepare/assets/js/56.js"><link rel="prefetch" href="/prepare/assets/js/560.js"><link rel="prefetch" href="/prepare/assets/js/561.js"><link rel="prefetch" href="/prepare/assets/js/562.js"><link rel="prefetch" href="/prepare/assets/js/563.js"><link rel="prefetch" href="/prepare/assets/js/564.js"><link rel="prefetch" href="/prepare/assets/js/565.js"><link rel="prefetch" href="/prepare/assets/js/566.js"><link rel="prefetch" href="/prepare/assets/js/567.js"><link rel="prefetch" href="/prepare/assets/js/568.js"><link rel="prefetch" href="/prepare/assets/js/569.js"><link rel="prefetch" href="/prepare/assets/js/57.js"><link rel="prefetch" href="/prepare/assets/js/570.js"><link rel="prefetch" href="/prepare/assets/js/571.js"><link rel="prefetch" href="/prepare/assets/js/572.js"><link rel="prefetch" href="/prepare/assets/js/573.js"><link rel="prefetch" href="/prepare/assets/js/574.js"><link rel="prefetch" href="/prepare/assets/js/575.js"><link rel="prefetch" href="/prepare/assets/js/576.js"><link rel="prefetch" href="/prepare/assets/js/577.js"><link rel="prefetch" href="/prepare/assets/js/578.js"><link rel="prefetch" href="/prepare/assets/js/579.js"><link rel="prefetch" href="/prepare/assets/js/58.js"><link rel="prefetch" href="/prepare/assets/js/580.js"><link rel="prefetch" href="/prepare/assets/js/581.js"><link rel="prefetch" href="/prepare/assets/js/582.js"><link rel="prefetch" href="/prepare/assets/js/583.js"><link rel="prefetch" href="/prepare/assets/js/584.js"><link rel="prefetch" href="/prepare/assets/js/585.js"><link rel="prefetch" href="/prepare/assets/js/586.js"><link rel="prefetch" href="/prepare/assets/js/587.js"><link rel="prefetch" href="/prepare/assets/js/588.js"><link rel="prefetch" href="/prepare/assets/js/589.js"><link rel="prefetch" href="/prepare/assets/js/59.js"><link rel="prefetch" href="/prepare/assets/js/590.js"><link rel="prefetch" href="/prepare/assets/js/591.js"><link rel="prefetch" href="/prepare/assets/js/592.js"><link rel="prefetch" href="/prepare/assets/js/593.js"><link rel="prefetch" href="/prepare/assets/js/594.js"><link rel="prefetch" href="/prepare/assets/js/595.js"><link rel="prefetch" href="/prepare/assets/js/596.js"><link rel="prefetch" href="/prepare/assets/js/597.js"><link rel="prefetch" href="/prepare/assets/js/598.js"><link rel="prefetch" href="/prepare/assets/js/599.js"><link rel="prefetch" href="/prepare/assets/js/6.js"><link rel="prefetch" href="/prepare/assets/js/60.js"><link rel="prefetch" href="/prepare/assets/js/600.js"><link rel="prefetch" href="/prepare/assets/js/601.js"><link rel="prefetch" href="/prepare/assets/js/602.js"><link rel="prefetch" href="/prepare/assets/js/603.js"><link rel="prefetch" href="/prepare/assets/js/604.js"><link rel="prefetch" href="/prepare/assets/js/605.js"><link rel="prefetch" href="/prepare/assets/js/606.js"><link rel="prefetch" href="/prepare/assets/js/607.js"><link rel="prefetch" href="/prepare/assets/js/608.js"><link rel="prefetch" href="/prepare/assets/js/609.js"><link rel="prefetch" href="/prepare/assets/js/61.js"><link rel="prefetch" href="/prepare/assets/js/610.js"><link rel="prefetch" href="/prepare/assets/js/611.js"><link rel="prefetch" href="/prepare/assets/js/612.js"><link rel="prefetch" href="/prepare/assets/js/613.js"><link rel="prefetch" href="/prepare/assets/js/614.js"><link rel="prefetch" href="/prepare/assets/js/615.js"><link rel="prefetch" href="/prepare/assets/js/616.js"><link rel="prefetch" href="/prepare/assets/js/617.js"><link rel="prefetch" href="/prepare/assets/js/618.js"><link rel="prefetch" href="/prepare/assets/js/619.js"><link rel="prefetch" href="/prepare/assets/js/62.js"><link rel="prefetch" href="/prepare/assets/js/620.js"><link rel="prefetch" href="/prepare/assets/js/621.js"><link rel="prefetch" href="/prepare/assets/js/622.js"><link rel="prefetch" href="/prepare/assets/js/623.js"><link rel="prefetch" href="/prepare/assets/js/624.js"><link rel="prefetch" href="/prepare/assets/js/625.js"><link rel="prefetch" href="/prepare/assets/js/626.js"><link rel="prefetch" href="/prepare/assets/js/627.js"><link rel="prefetch" href="/prepare/assets/js/628.js"><link rel="prefetch" href="/prepare/assets/js/629.js"><link rel="prefetch" href="/prepare/assets/js/63.js"><link rel="prefetch" href="/prepare/assets/js/630.js"><link rel="prefetch" href="/prepare/assets/js/631.js"><link rel="prefetch" href="/prepare/assets/js/632.js"><link rel="prefetch" href="/prepare/assets/js/633.js"><link rel="prefetch" href="/prepare/assets/js/634.js"><link rel="prefetch" href="/prepare/assets/js/635.js"><link rel="prefetch" href="/prepare/assets/js/636.js"><link rel="prefetch" href="/prepare/assets/js/637.js"><link rel="prefetch" href="/prepare/assets/js/638.js"><link rel="prefetch" href="/prepare/assets/js/639.js"><link rel="prefetch" href="/prepare/assets/js/64.js"><link rel="prefetch" href="/prepare/assets/js/640.js"><link rel="prefetch" href="/prepare/assets/js/641.js"><link rel="prefetch" href="/prepare/assets/js/642.js"><link rel="prefetch" href="/prepare/assets/js/643.js"><link rel="prefetch" href="/prepare/assets/js/644.js"><link rel="prefetch" href="/prepare/assets/js/645.js"><link rel="prefetch" href="/prepare/assets/js/646.js"><link rel="prefetch" href="/prepare/assets/js/647.js"><link rel="prefetch" href="/prepare/assets/js/648.js"><link rel="prefetch" href="/prepare/assets/js/649.js"><link rel="prefetch" href="/prepare/assets/js/65.js"><link rel="prefetch" href="/prepare/assets/js/650.js"><link rel="prefetch" href="/prepare/assets/js/651.js"><link rel="prefetch" href="/prepare/assets/js/652.js"><link rel="prefetch" href="/prepare/assets/js/653.js"><link rel="prefetch" href="/prepare/assets/js/654.js"><link rel="prefetch" href="/prepare/assets/js/655.js"><link rel="prefetch" href="/prepare/assets/js/656.js"><link rel="prefetch" href="/prepare/assets/js/657.js"><link rel="prefetch" href="/prepare/assets/js/658.js"><link rel="prefetch" href="/prepare/assets/js/659.js"><link rel="prefetch" href="/prepare/assets/js/66.js"><link rel="prefetch" href="/prepare/assets/js/660.js"><link rel="prefetch" href="/prepare/assets/js/661.js"><link rel="prefetch" href="/prepare/assets/js/662.js"><link rel="prefetch" href="/prepare/assets/js/663.js"><link rel="prefetch" href="/prepare/assets/js/664.js"><link rel="prefetch" href="/prepare/assets/js/665.js"><link rel="prefetch" href="/prepare/assets/js/67.js"><link rel="prefetch" href="/prepare/assets/js/68.js"><link rel="prefetch" href="/prepare/assets/js/69.js"><link rel="prefetch" href="/prepare/assets/js/7.js"><link rel="prefetch" href="/prepare/assets/js/70.js"><link rel="prefetch" href="/prepare/assets/js/71.js"><link rel="prefetch" href="/prepare/assets/js/72.js"><link rel="prefetch" href="/prepare/assets/js/73.js"><link rel="prefetch" href="/prepare/assets/js/74.js"><link rel="prefetch" href="/prepare/assets/js/75.js"><link rel="prefetch" href="/prepare/assets/js/76.js"><link rel="prefetch" href="/prepare/assets/js/77.js"><link rel="prefetch" href="/prepare/assets/js/78.js"><link rel="prefetch" href="/prepare/assets/js/79.js"><link rel="prefetch" href="/prepare/assets/js/8.js"><link rel="prefetch" href="/prepare/assets/js/80.js"><link rel="prefetch" href="/prepare/assets/js/81.js"><link rel="prefetch" href="/prepare/assets/js/82.js"><link rel="prefetch" href="/prepare/assets/js/83.js"><link rel="prefetch" href="/prepare/assets/js/84.js"><link rel="prefetch" href="/prepare/assets/js/85.js"><link rel="prefetch" href="/prepare/assets/js/86.js"><link rel="prefetch" href="/prepare/assets/js/87.js"><link rel="prefetch" href="/prepare/assets/js/88.js"><link rel="prefetch" href="/prepare/assets/js/89.js"><link rel="prefetch" href="/prepare/assets/js/9.js"><link rel="prefetch" href="/prepare/assets/js/90.js"><link rel="prefetch" href="/prepare/assets/js/91.js"><link rel="prefetch" href="/prepare/assets/js/92.js"><link rel="prefetch" href="/prepare/assets/js/93.js"><link rel="prefetch" href="/prepare/assets/js/94.js"><link rel="prefetch" href="/prepare/assets/js/95.js"><link rel="prefetch" href="/prepare/assets/js/96.js"><link rel="prefetch" href="/prepare/assets/js/97.js"><link rel="prefetch" href="/prepare/assets/js/98.js"><link rel="prefetch" href="/prepare/assets/js/99.js">
    <link rel="stylesheet" href="/prepare/assets/css/0.styles.c7089a63.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/prepare/" class="home-link router-link-active"><!----> <span class="site-name">Lu notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/prepare/" class="nav-link">首页</a></div><div class="nav-item"><a href="/prepare/js/" class="nav-link">Js</a></div><div class="nav-item"><a href="/prepare/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/prepare/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/prepare/framework/" class="nav-link router-link-active">框架通识</a></div><div class="nav-item"><a href="/prepare/safety/" class="nav-link">安全性能</a></div><div class="nav-item"><a href="/prepare/prepare/" class="nav-link">Prepare</a></div><div class="nav-item"><a href="/prepare/handrolledcode/" class="nav-link">手撸代码无敌</a></div><div class="nav-item"><a href="/prepare/dataalgorithm/" class="nav-link">数据算法</a></div><div class="nav-item"><a href="/prepare/engineering/" class="nav-link">工程化</a></div><div class="nav-item"><a href="/prepare/other/" class="nav-link">其他</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/prepare/" class="nav-link">首页</a></div><div class="nav-item"><a href="/prepare/js/" class="nav-link">Js</a></div><div class="nav-item"><a href="/prepare/react/" class="nav-link">React</a></div><div class="nav-item"><a href="/prepare/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/prepare/framework/" class="nav-link router-link-active">框架通识</a></div><div class="nav-item"><a href="/prepare/safety/" class="nav-link">安全性能</a></div><div class="nav-item"><a href="/prepare/prepare/" class="nav-link">Prepare</a></div><div class="nav-item"><a href="/prepare/handrolledcode/" class="nav-link">手撸代码无敌</a></div><div class="nav-item"><a href="/prepare/dataalgorithm/" class="nav-link">数据算法</a></div><div class="nav-item"><a href="/prepare/engineering/" class="nav-link">工程化</a></div><div class="nav-item"><a href="/prepare/other/" class="nav-link">其他</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/prepare/framework/JavaScript设计模式/" class="sidebar-heading clickable"><span>JavaScript设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/prepare/framework/UI组件/" class="sidebar-heading clickable"><span>UI组件</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/prepare/framework/框架通识/" class="sidebar-heading clickable open"><span>框架通识</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/prepare/framework/框架通识/10分钟快速入门rollupJs1.html" class="sidebar-link">10分钟快速入门rollupJs1</a></li><li><a href="/prepare/framework/框架通识/10分钟快速进阶rollupJs2.html" class="sidebar-link">10分钟快速进阶rollupJs2</a></li><li><a href="/prepare/framework/框架通识/37行代码构建无状态组件通信工具.html" class="sidebar-link">37行代码构建无状态组件通信工具</a></li><li><a href="/prepare/framework/框架通识/JavaScript模板引擎原理.html" class="active sidebar-link">JavaScript模板引擎原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/prepare/framework/框架通识/JavaScript模板引擎原理.html#一、前言" class="sidebar-link">一、前言</a></li><li class="sidebar-sub-header"><a href="/prepare/framework/框架通识/JavaScript模板引擎原理.html#二、js模板引擎的实现原理" class="sidebar-link">二、JS模板引擎的实现原理</a></li><li class="sidebar-sub-header"><a href="/prepare/framework/框架通识/JavaScript模板引擎原理.html#三、应用场景" class="sidebar-link">三、应用场景</a></li></ul></li><li><a href="/prepare/framework/框架通识/MVC-VS-Flux.html" class="sidebar-link">MVC-VS-Flux</a></li><li><a href="/prepare/framework/框架通识/MVVM.html" class="sidebar-link">MVVM</a></li><li><a href="/prepare/framework/框架通识/Object.defineProperty方法.html" class="sidebar-link">Object.defineProperty方法</a></li><li><a href="/prepare/framework/框架通识/Proxy.html" class="sidebar-link">Proxy</a></li><li><a href="/prepare/framework/框架通识/VirtualDom.html" class="sidebar-link">VirtualDom</a></li><li><a href="/prepare/framework/框架通识/VirtualDOM算法.html" class="sidebar-link">VirtualDOM算法</a></li><li><a href="/prepare/framework/框架通识/一行代码实现一个简单的模板字符串替换.html" class="sidebar-link">一行代码实现一个简单的模板字符串替换</a></li><li><a href="/prepare/framework/框架通识/使用EventEmitter2[观察者模式]构建前端应用.html" class="sidebar-link">使用EventEmitter2[观察者模式]构建前端应用</a></li><li><a href="/prepare/framework/框架通识/构建一个使用VirtualDOM的前端模版引擎.html" class="sidebar-link">构建一个使用VirtualDOM的前端模版引擎</a></li><li><a href="/prepare/framework/框架通识/谈谈JavaScript中的双向数据绑定.html" class="sidebar-link">谈谈JavaScript中的双向数据绑定</a></li><li><a href="/prepare/framework/框架通识/路由实现.html" class="sidebar-link">路由实现</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/prepare/framework/设计模式/" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript模板引擎原理，几行代码的事儿"><a href="#javascript模板引擎原理，几行代码的事儿" aria-hidden="true" class="header-anchor">#</a> JavaScript模板引擎原理，几行代码的事儿</h1> <ul><li><a href="#javascript%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%8E%9F%E7%90%86%E5%87%A0%E8%A1%8C%E4%BB%A3%E7%A0%81%E7%9A%84%E4%BA%8B%E5%84%BF">JavaScript模板引擎原理，几行代码的事儿</a> <ul><li><a href="#%E4%B8%80%E5%89%8D%E8%A8%80">一、前言</a></li></ul></li></ul> <h2 id="一、前言"><a href="#一、前言" aria-hidden="true" class="header-anchor">#</a> 一、前言</h2> <p>什么是模板引擎，说的简单点，就是一个字符串中有几个变量待定。比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> tpl <span class="token operator">=</span> <span class="token string">'Hei, my name is &lt;%name%&gt;, and I\'m &lt;%age%&gt; years old.'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过模板引擎函数把数据塞进去，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Barret Lee&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;20&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">tplEngine</span><span class="token punctuation">(</span>tpl<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Hei, my name is Barret Lee, and I'm 20 years old.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>那这玩意儿有什么作用呢？其实他就是一个预处理器（preprocessor），搞php开发的童鞋对Smarty必然是十分熟悉，Smarty是一个php模板引擎，tpl中待处理的字符通过数据匹配然后输出相应的html代码，加之比较给力的缓存技术，其速度和易用性是非常给力的！JS Template也是一样的，我们的数据库里保存着数以千万计的数据，而每一条数据都是通过同一种方式输入，就拿上面的例子来说，我们不可能在数据库里存几千条&quot;Hei, my name...&quot;，而是只保存对应的name和age，通过模板输出结果。</p> <p>JS模板引擎应该做哪些事情？看看下面一串代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> tpl <span class="token operator">=</span> <span class="token string">'&lt;% for(var i = 0; i &lt; this.posts.length; i++) {'</span> <span class="token operator">+</span>　
    <span class="token string">'var post = posts[i]; %&gt;'</span> <span class="token operator">+</span>
    <span class="token string">'&lt;% if(!post.expert){ %&gt;'</span> <span class="token operator">+</span>
        <span class="token string">'&lt;span&gt;post is null&lt;/span&gt;'</span> <span class="token operator">+</span>
    <span class="token string">'&lt;% } else { %&gt;'</span> <span class="token operator">+</span>
        <span class="token string">'&lt;a href=&quot;#&quot;&gt;&lt;% post.expert %&gt; at &lt;% post.time %&gt;&lt;/a&gt;'</span> <span class="token operator">+</span>
    <span class="token string">'&lt;% } %&gt;'</span> <span class="token operator">+</span>
<span class="token string">'&lt;% } %&gt;'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>一个基本的模板引擎至少可以保证上面的代码可以正常解析。如送入的数据是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;posts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token string">&quot;expert&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;content 1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;yesterday&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token string">&quot;expert&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;content 2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;today&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token string">&quot;expert&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;content 3&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;tomorrow&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token string">&quot;expert&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;eee&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>可以输出：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>content 1 at yesterday<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>content 2 at today<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>content 3 at tomorrow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>post is null<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="二、js模板引擎的实现原理"><a href="#二、js模板引擎的实现原理" aria-hidden="true" class="header-anchor">#</a> 二、JS模板引擎的实现原理</h2> <h3 id="_1-正则抠出要匹配的内容"><a href="#_1-正则抠出要匹配的内容" aria-hidden="true" class="header-anchor">#</a> 1.正则抠出要匹配的内容</h3> <p>针对这一串代码，通过正则获取内容</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> tpl <span class="token operator">=</span> <span class="token string">'Hei, my name is &lt;%name%&gt;, and I\'m &lt;%age%&gt; years old.'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Barret Lee&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;20&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>最简单的方式就是通过replace函数了：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> result <span class="token operator">=</span> tpl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&lt;%([^%&gt;]+)?%&gt;/g</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s0<span class="token punctuation">,</span> s1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> data<span class="token punctuation">[</span>s1<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>通过正则替换，我们很轻松的拿到了result，你可以去试一试，他正式我们想要的结果。但是这里又有了一个问题，改一下data和tpl，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> tpl <span class="token operator">=</span> <span class="token string">'Hei, my name is &lt;%name%&gt;, and I\'m &lt;%info.age%&gt; years old.'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Barret Lee&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;info&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> age<span class="token string">&quot;: &quot;</span><span class="token number">20</span>&quot;<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>再用上面的方式去获取结果，呵呵，不行了吧~ 这里data[&quot;info.age&quot;]本身就是undefined，所以我们需要换一种方式来处理这个问题，那就是将它转换成真正的JS代码。如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token string">'Hei, my name is '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">', and I\'m '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>info<span class="token punctuation">.</span>age<span class="token string">' + '</span> years old<span class="token punctuation">.</span>'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但是接着又有一个问题来了，当我们的代码中出现for循环和if的时候，上面的转换明显是不起作用的，如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> tpl <span class="token operator">=</span> <span class="token string">'Posts: '</span> <span class="token operator">+</span> 
          <span class="token string">'&lt;% for(var i = 0; i &lt; post.length; i++) {'</span><span class="token operator">+</span>
            <span class="token string">'&lt;a href=&quot;#&quot;&gt;&lt;% post[i].expert %&gt;&lt;/a&gt;'</span> <span class="token operator">+</span> 
          <span class="token string">'&lt;% } %&gt;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果继续采用上面的方式，得到的结果便是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token string">'Posts: '</span> <span class="token operator">+</span> 
       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">+</span>
         <span class="token string">'&lt;a href=&quot;#&quot;&gt;'</span> <span class="token operator">+</span> post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>exper <span class="token operator">+</span> <span class="token string">'&lt;/a&gt;'</span> <span class="token operator">+</span>
       <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这显然不是我们愿意看到的，稍微观察一下上面的结构，如果可以返回一个这样的结果也挺不错哦：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'Posts: '</span> 
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">'&lt;a href=&quot;#&quot;&gt;'</span> <span class="token operator">+</span> post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>exper <span class="token operator">+</span> <span class="token string">'&lt;/a&gt;'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>但是我们需要得到的是一个字符串，而不是上面这样零散的片段，因此可以把这些东西装入数组中。</p> <h3 id="_2-装入数组"><a href="#_2-装入数组" aria-hidden="true" class="header-anchor">#</a> 2.装入数组</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'Posts: '</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'&lt;a href=&quot;#&quot;&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>exper<span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'&lt;/a&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>有人看到上面的代码就要笑了，第三行和最后一行代码的逻辑明显是不正确的嘛，那肿么办呢？呵呵，很简单，不放进去就行了呗，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'Posts: '</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'&lt;a href=&quot;#&quot;&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>exper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'&lt;/a&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这样的逻辑就十分完善了，不存在太多的漏洞，但是这个转化的过程是如何实现的？我们必须还是要写一个解析的模板函数出来。</p> <h3 id="_3-分辨js逻辑部分"><a href="#_3-分辨js逻辑部分" aria-hidden="true" class="header-anchor">#</a> 3.分辨js逻辑部分</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
tpl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&lt;%([^%&gt;]+)?%&gt;/g</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s0<span class="token punctuation">,</span> s1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//完蛋了，这里貌似又要回到上面那可笑的逻辑有错误的一步啦... 该怎么处理比较好？</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>完蛋了，这里貌似又要回到上面那可笑的逻辑有错误的一步啦... 该怎么处理比较好？我们知道，JS给我们提供了构造函数的“类”，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> 
    <span class="token string">&quot;var r = []; for(var i in data){ r.push(data[i]); } return r.join(' ')&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;barretlee&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// barretlee 20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>知道了这个就好办了，我们可以把逻辑部分和非逻辑部分的代码链接成一个字符串，然后利用类似fn的函数直接编译代码。而/&lt;%([^%&gt;]+)?%&gt;/g，这一个正则只能把逻辑部分匹配出来，要想把所有的代码都组合到一起，必须还得匹配非逻辑部分代码。replace函数虽然很强大，他也可以完成这个任务，但是实现的逻辑比较晦涩，所以我们换另外一种方式来处理。</p> <p>先看一个简单的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex">/&lt;%([^%&gt;]+)?%&gt;/g</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> tpl <span class="token operator">=</span> <span class="token string">'Hei, my name is &lt;%name%&gt;, and I\'m &lt;%age%&gt; years old.'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> match <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>tpl<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>看到的是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;%name%&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">:</span> name<span class="token punctuation">,</span>
    index<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
    input<span class="token punctuation">:</span> <span class="token string">&quot;Hei, my name is &lt;%name%&gt;, and I'm &lt;%age%&gt; years old.&quot;</span>
    length<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这。。。我们可是想得到所有的匹配啊，他竟然只获取了name而忽略了后面的age，好吧，对正则稍微熟悉点的童鞋一定会知道应该这样处理：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex">/&lt;%([^%&gt;]+)?%&gt;/g</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>match <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>tpl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>关于正则表达式的内容就不在这里细说了，有兴趣的同学可以多去了解下match,exec,search等正则的相关函数。这里主要是靠match的index属性来定位遍历位置，然后利用while循环获取所有的内容。</p> <h3 id="_4-引擎函数"><a href="#_4-引擎函数" aria-hidden="true" class="header-anchor">#</a> 4.引擎函数</h3> <p>所以我们的引擎函数雏形差不多就出来了：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">tplEngine</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tpl<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex">/&lt;%([^%&gt;]+)?%&gt;/g</span><span class="token punctuation">,</span>
            code <span class="token operator">=</span> <span class="token string">'var r=[];\n'</span><span class="token punctuation">,</span>
            cursor <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//主要的作用是定位代码最后一截</span>
    <span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        code <span class="token operator">+=</span> <span class="token string">'r.push(&quot;'</span> <span class="token operator">+</span> line<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&quot;/g</span><span class="token punctuation">,</span> <span class="token string">'\\&quot;'</span><span class="token punctuation">)</span> <span class="token operator">+</span> '&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>\n'<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span>match <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>tpl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">add</span><span class="token punctuation">(</span>tpl<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> match<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//添加非逻辑部分</span>
        <span class="token function">add</span><span class="token punctuation">(</span>match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//添加逻辑部分 match[0] = &quot;&lt;%&quot; + match[1] + &quot;%&gt;&quot;;</span>
        cursor <span class="token operator">=</span> match<span class="token punctuation">.</span>index <span class="token operator">+</span> match<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">add</span><span class="token punctuation">(</span>tpl<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> tpl<span class="token punctuation">.</span>length <span class="token operator">-</span> cursor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//代码的最后一截 如:&quot; years old.&quot;</span>

    code <span class="token operator">+=</span> <span class="token string">'return r.join(&quot;&quot;);'</span><span class="token punctuation">;</span> <span class="token comment">// 返回结果，在这里我们就拿到了装入数组后的代码</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> tpl<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>这样一来，测试一个小demo:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> tpl <span class="token operator">=</span> <span class="token string">'&lt;% for(var i = 0; i &lt; this.posts.length; i++) {'</span> <span class="token operator">+</span>　
        <span class="token string">'var post = posts[i]; %&gt;'</span> <span class="token operator">+</span>
        <span class="token string">'&lt;% if(!post.expert){ %&gt;'</span> <span class="token operator">+</span>
            <span class="token string">'&lt;span&gt;post is null&lt;/span&gt;'</span> <span class="token operator">+</span>
        <span class="token string">'&lt;% } else { %&gt;'</span> <span class="token operator">+</span>
            <span class="token string">'&lt;a href=&quot;#&quot;&gt;&lt;% post.expert %&gt; at &lt;% post.time %&gt;&lt;/a&gt;'</span> <span class="token operator">+</span>
        <span class="token string">'&lt;% } %&gt;'</span> <span class="token operator">+</span>
    <span class="token string">'&lt;% } %&gt;'</span><span class="token punctuation">;</span>

<span class="token function">tplEngine</span><span class="token punctuation">(</span>tpl<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>返回的结果让人很满意：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> r<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot; for(var i = 0; i &lt; this.posts.length; i++) {var post = posts[i]; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot; if(!post.expert){ &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;span&gt;post is null&lt;/span&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot; } else { &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;a href=\&quot;#\&quot;&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot; post.expert &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot; at &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot; post.time &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/a&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot; } &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot; } &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>不过我们并需要for，if，switch等这些东西也push到r数组中去，所以呢，还得改善下上面的代码，如果在line中发现了包含js逻辑的代码，我们就不应该让他进门：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>regOut <span class="token operator">=</span> <span class="token regex">/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">line<span class="token punctuation">,</span> js</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    js<span class="token operator">?</span> code <span class="token operator">+=</span> line<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>regOut<span class="token punctuation">)</span> <span class="token operator">?</span> line <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token punctuation">:</span> <span class="token string">'r.push('</span> <span class="token operator">+</span> line <span class="token operator">+</span> <span class="token string">');\n'</span> <span class="token punctuation">:</span>
        code <span class="token operator">+=</span> <span class="token string">'r.push(&quot;'</span> <span class="token operator">+</span> line<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&quot;/g</span><span class="token punctuation">,</span> <span class="token string">'\\&quot;'</span><span class="token punctuation">)</span> <span class="token operator">+</span> '&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>\n'<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>所以我们只剩下最后一步工作了，把data扔进去！</p> <h3 id="_5-把data扔进去"><a href="#_5-把data扔进去" aria-hidden="true" class="header-anchor">#</a> 5.把data扔进去</h3> <p>没有比完成这东西更简单的事情啦，通过上面对Function这个函数的讲解，大家应该也知道怎么做了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用apply的作用就是让code中的一些变量作用域绑定到data上，不然作用域就会跑到global上，这样得到的数据索引就会出问题啦~ 当然我们可以再优化一下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[\r\t\n]/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>把回车换行以及tab键都给匹配掉，让代码更加干净一点。那么最终的代码就是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">tplEngine</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tpl<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex">/&lt;%([^%&gt;]+)?%&gt;/g</span><span class="token punctuation">,</span> 
        regOut <span class="token operator">=</span> <span class="token regex">/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g</span><span class="token punctuation">,</span> 
        code <span class="token operator">=</span> <span class="token string">'var r=[];\n'</span><span class="token punctuation">,</span> 
        cursor <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">line<span class="token punctuation">,</span> js</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        js<span class="token operator">?</span> <span class="token punctuation">(</span>code <span class="token operator">+=</span> line<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>regOut<span class="token punctuation">)</span> <span class="token operator">?</span> line <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token punctuation">:</span> <span class="token string">'r.push('</span> <span class="token operator">+</span> line <span class="token operator">+</span> <span class="token string">');\n'</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
            <span class="token punctuation">(</span>code <span class="token operator">+=</span> line <span class="token operator">!=</span> <span class="token string">''</span> <span class="token operator">?</span> <span class="token string">'r.push(&quot;'</span> <span class="token operator">+</span> line<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&quot;/g</span><span class="token punctuation">,</span> <span class="token string">'\\&quot;'</span><span class="token punctuation">)</span> <span class="token operator">+</span> '&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token string">' : '</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> add<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>match <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>tpl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">add</span><span class="token punctuation">(</span>tpl<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> match<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cursor <span class="token operator">=</span> match<span class="token punctuation">.</span>index <span class="token operator">+</span> match<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">add</span><span class="token punctuation">(</span>tpl<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> tpl<span class="token punctuation">.</span>length <span class="token operator">-</span> cursor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    code <span class="token operator">+=</span> <span class="token string">'return r.join(&quot;&quot;);'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[\r\t\n]/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="三、应用场景"><a href="#三、应用场景" aria-hidden="true" class="header-anchor">#</a> 三、应用场景</h2> <p>毕竟是前端代码，所以写出来是要为前端服务的，平时我们处理的一般是一个html的模板，通常的情况下，模板代码是放在script标签或者textarea中，所以首先是要获取到这里头的东西，然后再来做解析。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">barretTpl</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//获取元素</span>
    <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//textarea或input则取value，其它情况取innerHTML</span>
        <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token regex">/^(textarea|input)$/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span> <span class="token operator">?</span> element<span class="token punctuation">.</span>value <span class="token punctuation">:</span> element<span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">tplEngine</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//是模板字符串，则生成一个函数</span>
        <span class="token comment">//如果直接传入字符串作为模板，则可能变化过多，因此不考虑缓存</span>
        <span class="token keyword">return</span> <span class="token function">tplEngine</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> <span class="token function-variable function">tplEngine</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tpl<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// content above</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/prepare/framework/框架通识/37行代码构建无状态组件通信工具.html" class="prev">37行代码构建无状态组件通信工具</a></span> <span class="next"><a href="/prepare/framework/框架通识/MVC-VS-Flux.html">MVC-VS-Flux</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/prepare/assets/js/styles.js" defer></script><script src="/prepare/assets/js/3.js" defer></script><script src="/prepare/assets/js/2.js" defer></script><script src="/prepare/assets/js/219.js" defer></script><script src="/prepare/assets/js/app.js" defer></script>
  </body>
</html>
